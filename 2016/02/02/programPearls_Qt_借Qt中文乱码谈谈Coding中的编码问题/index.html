<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="Tarantula-7" />



<meta name="description" content="[系列文章]上一篇：《这是第一篇》[系列文章]下一篇：《Coding中的编码问题之入门&amp;amp;概览》

　　因为想着把毕业设计中的读写器上位机软件放在 Qt 上开发，这学期《物联网导论实验课程》也做过一个类似的上位机软件，不过是在 MFC 上开发，所以想到先做一下这个课程 Project 的移植，体验一发 Qt，没想到一开始就碰大壁了。。。
　　相信大家也经常遇到，那就是做 UI 界面时或者通过">
<meta property="og:type" content="article">
<meta property="og:title" content="借Qt中文乱码谈谈Coding中的编码问题">
<meta property="og:url" content="http://durant35.github.io/2016/02/02/programPearls_Qt_借Qt中文乱码谈谈Coding中的编码问题/index.html">
<meta property="og:site_name" content="Tarantula-7's Blog">
<meta property="og:description" content="[系列文章]上一篇：《这是第一篇》[系列文章]下一篇：《Coding中的编码问题之入门&amp;amp;概览》

　　因为想着把毕业设计中的读写器上位机软件放在 Qt 上开发，这学期《物联网导论实验课程》也做过一个类似的上位机软件，不过是在 MFC 上开发，所以想到先做一下这个课程 Project 的移植，体验一发 Qt，没想到一开始就碰大壁了。。。
　　相信大家也经常遇到，那就是做 UI 界面时或者通过">
<meta property="og:image" content="http://durant35.github.io/img/programPearls/encoding/mingw.png">
<meta property="og:image" content="http://durant35.github.io/img/programPearls/encoding/kit.png">
<meta property="og:image" content="http://durant35.github.io/img/programPearls/encoding/uierror.png">
<meta property="og:image" content="http://durant35.github.io/img/programPearls/encoding/behavior.png">
<meta property="og:image" content="http://durant35.github.io/img/programPearls/encoding/noBOM_error.jpg">
<meta property="og:image" content="http://durant35.github.io/img/programPearls/encoding/encodingResult.png">
<meta property="og:image" content="http://durant35.github.io/img/programPearls/encoding/ANSI-GBK.png">
<meta property="og:image" content="http://durant35.github.io/img/programPearls/encoding/ANSI-Big5.png">
<meta property="og:image" content="http://durant35.github.io/img/programPearls/encoding/noBOM_error.jpg">
<meta property="og:image" content="http://durant35.github.io/img/programPearls/encoding/QString_encoding.png">
<meta property="og:updated_time" content="2016-11-12T12:31:44.186Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="借Qt中文乱码谈谈Coding中的编码问题">
<meta name="twitter:description" content="[系列文章]上一篇：《这是第一篇》[系列文章]下一篇：《Coding中的编码问题之入门&amp;amp;概览》

　　因为想着把毕业设计中的读写器上位机软件放在 Qt 上开发，这学期《物联网导论实验课程》也做过一个类似的上位机软件，不过是在 MFC 上开发，所以想到先做一下这个课程 Project 的移植，体验一发 Qt，没想到一开始就碰大壁了。。。
　　相信大家也经常遇到，那就是做 UI 界面时或者通过">
<meta name="twitter:image" content="http://durant35.github.io/img/programPearls/encoding/mingw.png">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Tarantula-7&#39;s Blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/img/favicon.ico">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>借Qt中文乱码谈谈Coding中的编码问题 | Tarantula-7&#39;s Blog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: undefined
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Tarantula-7</a></h1>
        </hgroup>

        
        <p class="header-subtitle">My Body Knows It&#39;s Time to Say GoodBye... ---- Dear Basketball</p>
        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">Home</a></li>
                        
                            <li><a href="/tags">All-tags</a></li>
                        
                            <li><a href="/archives">All-lists</a></li>
                        
                            <li><a href="/Shengjie">Contact</a></li>
                        
                            <li><a href="/about">About</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa 新浪微博" href="http://weibo.com/u/2911566017/home?topnav=1&wvr=6" title="新浪微博"></a>
                            
                                <a class="fa GitHub" href="https://github.com/Durant35" title="GitHub"></a>
                            
                                <a class="fa OSChina" href="https://my.oschina.net/love7zx/" title="OSChina"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMD/">CMD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMake/">CMake</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DLL/">DLL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSP/">JSP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Key-words/">Key-words</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MFC/">MFC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NotePad/">NotePad++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenCL/">OpenCL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenGL/">OpenGL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PCB/">PCB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Qt/">Qt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ROS/">ROS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/STM32/">STM32</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Socket/">Socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VS2013/">VS2013</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/">Windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dumpbin/">dumpbin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ini/">ini</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pcap/">pcap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文件操作/">文件操作</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/漫威电影/">漫威电影</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编码/">编码</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://github.com/">GitHub</a>
                    
                    </div>
                </section>
                

                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Tarantula-7</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Tarantula-7</a></h1>
            </hgroup>
            
            <p class="header-subtitle">My Body Knows It&#39;s Time to Say GoodBye... ---- Dear Basketball</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">Home</a></li>
                
                    <li><a href="/tags">All-tags</a></li>
                
                    <li><a href="/archives">All-lists</a></li>
                
                    <li><a href="/Shengjie">Contact</a></li>
                
                    <li><a href="/about">About</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa 新浪微博" target="_blank" href="http://weibo.com/u/2911566017/home?topnav=1&wvr=6" title="新浪微博"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/Durant35" title="GitHub"></a>
                            
                                <a class="fa OSChina" target="_blank" href="https://my.oschina.net/love7zx/" title="OSChina"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-programPearls_Qt_借Qt中文乱码谈谈Coding中的编码问题" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/02/programPearls_Qt_借Qt中文乱码谈谈Coding中的编码问题/" class="article-date">
      <time datetime="2016-02-02T11:33:21.000Z" itemprop="datePublished">2016-02-02</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      借Qt中文乱码谈谈Coding中的编码问题
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/编程珠玑/">编程珠玑</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Qt/">Qt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/VS2013/">VS2013</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/编码/">编码</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <font color="green" size="4">[系列文章]上一篇：<a href="http://durant35.github.io/2016/02/02/programPearls_Qt_%E5%80%9FQt%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E8%B0%88%E8%B0%88Coding%E4%B8%AD%E7%9A%84%E7%BC%96%E7%A0%81%E9%97%AE%E9%A2%98/#more">《这是第一篇》</a><br>[系列文章]下一篇：<a href="http://durant35.github.io/2016/02/21/programPearls_Coding%E4%B8%AD%E7%9A%84%E7%BC%96%E7%A0%81%E9%97%AE%E9%A2%98%E4%B9%8B%E5%85%A5%E9%97%A8&amp;%E6%A6%82%E8%A7%88/#more">《Coding中的编码问题之入门&amp;概览》</a></font>

<p>　　因为想着把毕业设计中的读写器上位机软件放在 <strong>Qt</strong> 上开发，这学期<a href="http://durant35.github.io/categories/%E7%89%A9%E8%81%94%E7%BD%91%E6%8A%80%E6%9C%AF%E5%AF%BC%E8%AE%BA%E5%AE%9E%E9%AA%8C%E8%AF%BE/">《物联网导论实验课程》</a>也做过一个类似的上位机软件，不过是在 <strong>MFC</strong> 上开发，所以想到先做一下这个课程 <strong>Project</strong> 的移植，体验一发 <strong>Qt</strong>，没想到一开始就碰大壁了。。。</p>
<p>　　相信大家也经常遇到，那就是做 <strong>UI</strong> 界面时或者通过 <strong>UI</strong> 给用户提示时，<strong>中文乱码</strong> 的现象。比如，这学期，在上《物联网导论实验课》的时候，虽然课程建议的开发平台是 <strong>VC++ 6.0</strong>，但是有部分同学尝试在 <strong>VS≥2012</strong> 开发，就发现，课程 <strong>Demo</strong> 给的部分示例代码直接放到 <strong>VS</strong> 上，就出现了 <strong>UI</strong> 中文乱码的现象。他们，或者说大多数人一开始想到的问题，无非就是项目相关文件保存方式弄错了，也许改一下保存编码方式就行。但是真的是这样吗？还有编码方式是什么，解决这个问题需要了解多少东西？本期及之后的几篇文章，将会跟大家讲述本人在解决这个问题过程中的学习体会，包括从网上学习的各种资料的汇总。一来希望能给遇到相关问题的亲们指引一下(希望对你有帮助，嘻嘻)，二来更是把自己这近几周的学习作一个系统总结，留档，方便后知后觉忘了的时候，可以温故知新。<br><a id="more"></a></p>
<h2 id="先说说环境"><a href="#先说说环境" class="headerlink" title="先说说环境"></a><font color="#F40D64">先说说环境</font></h2><p>　　这是我的本本：<br>　　　- <strong>操作系统：</strong> <strong>Win8.1</strong> 专业版<br>　　　- <strong>VS：</strong> 安装了 <strong>Visual Studio2013</strong>，应该是 <strong>64-bit</strong> 的<br>　　　- <strong>Qt版本：</strong> <a href="http://download.qt.io/official_releases/qt/5.5/5.5.1/qt-opensource-windows-x86-msvc2013_64-5.5.1.exe.mirrorlist">Qt 5.5.1 for Windows 64-bit (VS 2013, 823 MB)，qt-opensource-windows-x86-msvc2013_64-5.5.1.exe</a><br>　　　- <strong>开发IDE：</strong> 使用上述安装包中自带的 <strong>Qt Creator3.5.1(Based on Qt5.5.1(MSVC2013, 32bit))</strong>，不过上面的 <strong>Qt</strong> 版本应该是 <strong>64</strong> 位的(见下图)。<br>　　　- <strong>其他： </strong>32 位的 <strong>MINGW</strong> (这个后来发现没什么卵用)<strong>：</strong><br>    <center><img src="/img/programPearls/encoding/mingw.png" width="440px"/></center><br>　　　下面是 <strong>Qt Creator</strong> 中构建套件截图：<center><img src="/img/programPearls/encoding/kit.png" width="480px"/></center></p>
<h2 id="再看看问题"><a href="#再看看问题" class="headerlink" title="再看看问题"></a><font color="#F40D64">再看看问题</font></h2><p>　　新建 <strong>Qt Widgets Application</strong>，<strong>UI</strong> 主框架是两个切换选项卡，只需要在界面设计栏中拖入 <strong>Containers → Tab Widget</strong>，适当调整大小即可。然后需要在 <strong>MainWindow 类构造函数</strong> 中添加代码(因为这部分是在界面呈现之前需要完成的部分，放在构造函数中理所应当)：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">MainWindow::MainWindow(QWidget *parent) :</div><div class="line">    QMainWindow(parent),</div><div class="line">    ui(<span class="keyword">new</span> Ui::MainWindow)</div><div class="line">&#123;</div><div class="line">    ui-&gt;setupUi(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">    <span class="comment">// 设置标签名</span></div><div class="line">    ui-&gt;tabWidget-&gt;setTabText(<span class="number">0</span>, <span class="string">"调试助手"</span>);</div><div class="line">    ui-&gt;tabWidget-&gt;setTabText(<span class="number">1</span>, <span class="string">"应用开发"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　<strong>ui</strong> 通过初始化列表<font color="blue"><strong>（初始化列表以冒号开头，后跟一系列以逗号分隔的初始化字段）</strong></font>这种方式已经和我们的界面绑定，通过 <strong><code>ui-&gt;tabWidget</code></strong> 则可以获取到我们新添加进去的 <strong>Tab Widget</strong>，然后就是调用 <strong>Tab Widget</strong> 的 <strong>API</strong>，<strong><code>setTabText</code></strong> 设置标签名，第一个参数是下标，从 <strong>0</strong> 开始计数，第二个参数则是标签名。构建运行，结果如下图：<br>    <center><img src="/img/programPearls/encoding/uierror.png" width="640px"/></center><br><span style="color:red; font-size:138%"><strong>分析： </strong></span></p>
<ul>
<li>确实实现了两个标签的选项卡，也能正常实现切换，问题就是，这两个标签究竟是什么鬼…这就是上面提到多次的 <strong>中文乱码</strong>。</li>
<li>有人会说肯定是源文件编码方式出错了，造成乱码。<strong>Qt Creator</strong> （更准确的说，我这里的 <strong>Qt Creator</strong> ）文件保存方式默认是 <strong>使用带BOM的UTF-8</strong> 保存的（说的是什么鸟语，如果不懂这些到后面你就会懂了，还有，我是怎么知道的，用 <strong>NotePad++</strong> 打开 <strong>Qt</strong> 工程目录下的文件，<strong>HexViewer</strong> 一下便知道了，后续也会说）。而我们的 <strong>UI</strong> 文件，也是按照 <strong>UTF-8</strong> 编码的，因为 <strong>.ui</strong> 文件其实是一个 <strong>xml</strong> 文件：<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">ui</span> <span class="attr">version</span>=<span class="string">"4.0"</span>&gt;</span></div><div class="line">  ...</div><div class="line"><span class="tag">&lt;/<span class="name">ui</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p>　　按理说，不会因此造成乱码的。事实是，不管你把源文件（主要是带有我们汉字的 <strong><code>mainwindow.cpp</code></strong>）的编码方式变成哪一种，还是照样乱码，而且是同一种乱法，都是上图那个样。</p>
<font color="red" size="4"><strong>怎么调文件的编码呢？ </strong></font>

<p>　　<strong>第一种： </strong>菜单栏<code>工具</code> →<code>选项</code> →<code>文本编辑器</code> →<code>行为</code>：<br>    <center><img src="/img/programPearls/encoding/behavior.png" width="720px"/></center><br>　　对<strong><code>文件编码</code></strong> 的 <strong><code>默认编码</code></strong> 和 <strong><code>UTF-8 BOM</code></strong> 进行设置，然后 <strong><code>Apply</code></strong> 应用设置。注意，个人认为此处设置的是默认编码，会对新建的项目或文件有效，也就是说，这里设置成什么样，整个 <strong>Qt</strong> 的文件默认编码方式就是什么；不过对你已经创建的文件，可能没什么影响，个人体会是这样。</p>
<p>　　<strong>第二种： </strong>那已经存在的文件怎么修改编码方式呢？菜单栏 <strong><code>编辑</code> →<code>Select Encoding...</code> →<code>选择编码方式</code> →<code>按编码保存</code></strong>。</p>
<p>　　如上图所示，我的默认编码采用 <strong><code>UTF-8</code></strong> 而且采取 <strong><code>如果编码是UTF-8则添加BOM</code></strong> 的方式，也是 <strong>建议大家采用的（后面你就明白了）</strong>。上面说到修改文件的编码，我通过第二种方式大概尝试了 <strong>System</strong> (本系统是简体中文的 <strong>Win8.1</strong>，这里的 <strong>System 编码</strong>，应该等同于 <strong>ANSI</strong>，也就是 <strong>GBK 编码</strong>（繁体中文则是 <strong>Big5 编码</strong>）)、<strong>GB2312</strong> (汉字国(家)标(准)，<strong>GBK</strong> 兼容 <strong>GB2312</strong>，是其的扩展)、<strong>UTF-8带BOM</strong> 和 <strong>不带BOM的UTF-8</strong> （设置成<code>如果编码是UTF-8则添加</code>然后按 <strong>UTF-8</strong> 编码保存即是 <strong>带BOM的UTF-8</strong>，设置成 <code>总是删除</code> 然后按 <strong>UTF-8</strong> 编码保存则是 <strong>不带BOM的UTF-8</strong> ）这几种。具体的编码是什么，这一块的知识会在后面陆续为大家介绍。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a><font color="#F40D64">解决方案</font></h2><p>　　不管你按照上面说的改文件编码方式，改成什么，都没有用。还是乱码，而且乱的是一个样子，故我的初步估算是，这其实跟源文件的编码没什么关系。更恐怖的是，如果你改成 <strong>不带BOM的UTF-8</strong> 保存你的文件，甚至会报错，如下：<br>    <center><img src="/img/programPearls/encoding/noBOM_error.jpg"/></center><br>　　看到这个，我的疑惑只有，什么是 <strong>代码页</strong>（后面也会跟你说的）；还有，哦不，太可怕了，我赶紧退回去上一种编码，然后运行一下，发现错误没了，这才松了口气。<br>　　既然该文件编码没用，跟源文件编码没多大关系，那怎么解决呀，存在乱码可不行，毕竟这是 <strong>BUG</strong> 呀。</p>
<p>　　我就看了下这一篇文章<a href="http://blog.csdn.net/libaineu2004/article/details/19245205">《解决Qt中文乱码以及汉字编码的问题(UTF-8/GBK)》</a>。主要的内容摘要如下，你可以亲自去看看。</p>
<div style="background-color: #CFD5DB"><font color="blue"><br>一、<strong>Qt 环境设置</strong><br>　　文件从 <strong>window</strong> 上传到 <strong>Ubuntu</strong> 后会显示乱码,原因是因为 <strong>Ubuntu</strong> 环境设置默认是 <strong>utf-8</strong>，<strong>Windows</strong> 默认都是<strong>GBK</strong>。<br>　　<strong>Windows</strong> 环境下，<strong>Qt Creator</strong>，<code>菜单-&gt;工具-&gt;选项-&gt;文本编辑器-&gt;行为-&gt;文件编码</code>:<br>　　默认编码: <strong>System</strong> (简体中文 <strong>windows</strong> 系统默认指的是 <strong>GBK</strong> 编码，即下拉框选项里的 <strong>GBK/windows-936-2000/CP936/MS936/ windows-936</strong>)<br>　　<font color="#D3442D">注： 这些是不是和我上面说的差不多，其实我是参考人家的，现在看来，其实也验证了我上面的说法。</font><br>二、<strong>编码知识科普</strong><br>　　<strong>Qt</strong> 常见的两种编码是: <strong>UTF-8</strong> 和 <strong>GBK</strong><br>　　★ UTF-8： <strong>Unicode TransformationFormat-8bit</strong>，允许含 <strong>BOM</strong>，但通常不含 <strong>BOM</strong>。是用以解决国际上字符的一种多字节编码，它对英文使用 8 位（即一个字节），中文使用 24 位（三个字节）来编码。<strong>UTF-8</strong> 包含全世界所有国家需要用到的字符，是国际编码，通用性强。<strong>UTF-8</strong> 编码的文字可以在各国支持 <strong>UTF8</strong> 字符集的浏览器上显示。如，如果是 <strong>UTF8</strong> 编码，则在外国人的英文 IE 上也能显示中文，他们无需下载 IE 的中文语言支持包。<br>　　★ <strong>GBK</strong> 是国家标准 <strong>GB2312</strong> 基础上扩容后兼容 <strong>GB2312</strong> 的标准。<strong>GBK</strong> 的文字编码是用双字节来表示的，即不论中、英文字符均使用双字节来表示，为了区分中文，将其最高位都设定成 1。<strong>GBK</strong> 包含全部中文字符，是国家编码，通用性比 <strong>UTF-8</strong> 差，不过 <strong>UTF-8</strong> 占用的数据库比 <strong>GBK</strong> 大。<strong>GBK</strong> 是 <strong>GB2312</strong> 的扩展，除了兼容 <strong>GB2312</strong> 外，它还能显示繁体中文，还有日文的假名。<br>　　★ <strong>GBK</strong>、<strong>GB2312</strong> 等与 <strong>UTF-8</strong> 之间都必须通过 <strong>Unicode 编码</strong> 才能相互转换：<br>　　　GBK、GB2312－－Unicode－－UTF8<br>　　　UTF8－－Unicode－－GBK、GB2312<br>　　★在简体中文 <strong>windows</strong> 系统下，<strong>ANSI 编码</strong> 代表 <strong>GBK/GB2312</strong> 编码，<font color="green"><strong>ANSI</strong>  通常使用 <code>0x80~0xFF</code> 范围的 2 个字节来表示 1 个中文字符</font>。<code>0x00~0x7F</code> 之间的字符，依旧是 1 个字节代表 1 个字符。<strong>Unicode(UTF-16)</strong> 编码则所有字符都用 2 个字节表示。<br>　　<font color="#D3442D">注：这里贴给大家先做个了解，大概的疑惑应该会有：<br>　　　1、什么是 <strong>UTF-8</strong> 和 <strong>GBK</strong>，他们是怎样表示汉字和英文的？<br>　　　2、<strong>UTF-8</strong> 有带不带 <strong>BOM</strong> 之分，究竟什么是 <strong>BOM</strong> 呢？<br>　　　3、<strong>GBK</strong> 中英文都用两个字节表示，为了区分中文，将其最高位都设定为 1，这种区分似乎挺重要的，我要仔细了解一下！<br>　　　4、这中间提到的 <strong>GB2312</strong> 和 <strong>Unicode</strong> 编码又是什么？<br>　　　5、<strong>ANSI</strong> 中 <code>0x00~0x7F</code> 之间的字符，依旧是 1 个字节代表 1 个字符，<code>0x00~0x7F</code>是不是就是最常见的 <strong>ASCII</strong> 编码，起码他们的范围是一致的，而且都是一个字节。<br><br>　　　这些疑惑相信你后续都会弄明白的。不过这里说的 <strong>Unicode</strong> 编码，就像作者后面 <strong>(UTF-16)</strong> 这个括号加上去一样，他应该指的是 <strong>UTF-16</strong> 这种编码方式。而 <strong>Unicode</strong>，更准确的理解，它应该是一种字符集。那你<font color="green">可能会疑惑，字符集又是什么，他跟编码方式为什么不能一概而论，有什么区别？</font>另外这里说的，<strong>UTF-16</strong> 编码则所有字符都用两个字节表示，其实不太对，<strong>UTF-16</strong> 跟 <strong>UTF-8</strong> 一样，都是变长编码方式(你一定会想到有变长肯定有定长之说，的确，那二者有什么区别呢？)。此外，不只 <strong>UTF-8</strong> 有 <strong>BOM</strong>，<strong>UTF-16</strong> 也有 <strong>BOM</strong>，而且，<strong>UTF-8</strong> 的 <strong>BOM</strong> 可有可无，<font color="green"><strong>UTF-16</strong> 的 <strong>BOM</strong> 可是有大用处，也是 <strong>BOM</strong> 的本质由来，区分大小端——那什么是大小端？怎么区分法？</font>这些你先大致了解，后续会让你明白的。</font><br>三、<strong>编码转换</strong><br>　　<strong>UTF-8</strong> 与 <strong>ANSI</strong> （即 <strong>GBK</strong>）的互转,可以使用 <strong>EditPlus</strong> 工具”文件另存为”或者 <strong>Encodersoft</strong> 编码转换工具对 <strong>.cpp</strong> 和 <strong>.h</strong> 源文件文本进行批量转换。<br>　　<font color="#D3442D">注：我试了下 <strong>EditPlus</strong> 工具，哭晕了，不好用的啦。后来发现 <strong>NotePad++</strong> 似乎更好用好多。怎么用嘛，<a href="http://durant35.github.io/2016/02/02/tool_NotePad/#more">看这里</a>。</font><br>四、<strong>Qt 编码指定</strong><br>　　<strong>Qt</strong> 需要在 <strong>main()</strong> 函数指定使用的字符编码:<br>　　　<code>#include &lt;QTextCodec&gt;</code><br>　　　<code>QTextCodec *codec = QTextCodec::codecForName(&quot;GBK&quot;);</code>　//情况 2 是此处 <strong>“GBK”</strong> 变为 <strong>“UTF-8”</strong><br>　　　<code>QTextCodec::setCodecForTr(codec);</code><br>　　　<code>QTextCodec::setCodecForLocale(codec);</code><br>　　　<code>QTextCodec::setCodecForCStrings(codec);</code><br>　　这里只列举大家最常用的3个编译器（<strong>微软VS的中的cl</strong>，<strong>Mingw中的g++</strong>，<strong>Linux下的g++</strong>），源代码分别采用 <strong>GBK</strong> 和 <strong>无BOM的UTF-8</strong> 以及 <strong>有BOM的UTF-8</strong> 这 3 种编码进行保存，发生的现象如下表所示。<br>    <center><img src="/img/programPearls/encoding/encodingResult.png" width="640px"/></center><br>　　<font color="#D3442D">注：上面的现象似乎挺对的，反正我们在 <strong>Win</strong> 下使用 <strong>VS2013的cl编译器</strong>，保存成 <code>不带BOM的UTF-8</code> 出现上面的错误，编译确实不通过。至于其他平台，有兴趣你就去试试吧，反正姑且我是信了他。至于这其中的乱码解决方案，尝试了一下，才发现，<code>setCodecForTr</code> 和 <code>setCodecForCStrings</code> 这两个 <strong>API</strong> 在 <strong>Qt5</strong> 及以上版本已经不存在了，这一部分是通过阅读这一篇博客了解到<a href="http://blog.csdn.net/dbzhang800/article/details/7325698">《QTextCodec中的setCodecForTr等终于消失了 (Qt5)》</a>，下面是这篇<a href="#blog_analysis">博客的摘要及分析。</a>所以，这一篇文章到此处，只能说他提出的解决方案并不太好，已经被人舍弃了，而且这个解决方案也不适用于我目前的情况，谁叫我的版本已经是最新的 <strong>Qt5.5</strong> 了呢…</font><br>五、<strong>应用案例</strong><br>　　<strong>QCom</strong> 跨平台串口调试助手(<a href="http://www.qter.org/?page_id=203">http://www.qter.org/?page_id=203</a>)<br>　　　　… …<br><br>　　<font color="#D3442D">注：这一部分主要说了作者自己的一个开源项目，串口调试助手，看了一下，有相关需要再借鉴参考；另外就是上面我们提到的不带 <strong>BOM</strong> 的 <strong>UTF-8</strong> 保存的话会报的错，只能改成其他其他编码了，反正 <strong>UTF-8</strong> 一定要带 <strong>BOM</strong> 就是了；至于他解决乱码的方式，使用的是 <strong>Qt5</strong> 以下的那种，上面也提到说已经被拧掉，加上我们这里是 <strong>Qt5</strong> 以上，就不说他了。</font><br>六、<strong>结论</strong><br>　　①、<strong>Windows</strong> 环境下，<strong>Qt Creator</strong> + <strong>微软VS编译器</strong>，新建工程，<br>　　　1、如果该工程不需要跨平台使用（只在 <strong>win</strong>），那么工程设置请使用 <strong>GBK</strong> 的编码方式.<br>　　　2、如果该工程要跨平台使用（<strong>win+linux</strong>），那么工程设置请使用 <strong>UTF-8+BOM</strong> 的编码方式.<br>　　②、<strong>Linux</strong> 环境下，<strong>Qt Creator+gcc</strong>，新建工程，<br>　　　没有 <strong>GBK</strong> 编码可选，默认是 <strong>UTF-8(无BOM)</strong> 编码方式，考虑到跨平台，建议选择 <strong>UTF-8+BOM</strong> 的编码方式.<br>　　<font color="#D3442D">注：这一个，个人觉得大致是可行的，只不过，<strong>Qt5</strong> 之后，所有的东东好像都是 <strong>UTF</strong> 为默认，比如 <strong>QString</strong> 就是默认按照 <strong>UTF-16</strong> 保存的，所以估计 <strong>GBK</strong> 这一套行不通。考虑到跨平台，也建议全都使用 <strong>UTF-8+BOM</strong> 的编码方式保存，至于乱码的解决方案，下面会跟大家详细说明。</font><br>七、<strong>参考文献</strong><br>　　<strong>Qt</strong> 中文乱码问题 <a href="http://blog.csdn.net/brave_heart_lxl/article/details/7186631">http://blog.csdn.net/brave_heart_lxl/article/details/7186631</a><br></font></div>

<p>　　所以，到底这篇博客还是搞不定我们的问题呀，怎么办呢？上面不是说到，阅读期间按照博主的方法试了一下发现那两个 <strong>API</strong> 行不通吗。后来就把这个跟 <strong>Qt</strong> 版本有关的问题一搜，找到另外一篇<span id="blog_analysis"><a href="http://blog.csdn.net/dbzhang800/article/details/7325698">《QTextCodec中的setCodecForTr等终于消失了 (Qt5)》</a><span>，这篇文章内容比较散，就把读后认为比较重要的内容记录在下：</p>
<div style="background-color: #CFD5DB"><font color="blue"><br>　　<font color="#D3442D">博客前面部分正是对上述博客 <strong>《解决 Qt 中文乱码以及汉字编码的问题（UTF-8/GBK）》</strong> 中提出的该种解法的说词，道出这种解法的不合理以及最终在 <strong>Qt5</strong> 中这两个 <strong>API</strong> 木有了，终于让这种乱套解法到头了！</font><br>　　在 Qt5 中，这两个函数：<br>　　　QTextCodec::setCodecForTr(…)<br>　　　QTextCodec::setCodecForCStrings(…)<br>　　被直接去掉了。这样一来，受影响的直接是如下代码了：<br>　　　QString s1 = “我是中文”;<br>　　　QString s2(“我是中文”);<br>　　　QString s3 = QObject::tr(“我是中文”);<br>　　<font color="#D3442D">通过这篇博客，了解到上面的”我是中文”，以及我们上述示例中的”调试助手”和”应用开发”是 <strong>const char*窄字符串</strong>，因为其中包含了中文，所以出现了乱码。<br>　　博客说道：</font><br>　　现在 <strong>Qt5</strong> 中尽管去掉了<strong>setCodecXXX</strong> 这两个函数，但是默认编码还是 <strong>latin-1</strong>。如果你要想使用”我是中文”这样的字符串，必须自己使用 <strong>QTextCodec</strong> 或这 <strong>QString::fromXXX</strong> 这种东西进行转换。<br>　　<font color="#D3442D">却又说到：</font><br>　　<strong>Qt5</strong> 发布之时，默认将会是 <strong>utf8</strong> 编码，完全可以将你从 <strong>Qt</strong> 编码问题解放出来。如果你在 <strong>Windows</strong> 下，且使用的是 <strong>MinGW</strong>，那么只要你将源码文件保存成 <strong>utf8</strong>，下面的代码将直接可以工作（无须其他设置）<br>　　　QString s1 = “我是中文”;<br>　　　QString s2(“我是中文”);<br>　　　QString s3 = QObject::tr(“我是中文”);<br>　　如果你在其他平台了，那么应该都默认是<strong>utf8</strong> 文件。同样无须进行设置。<br>　　<font color="#D3442D">那究竟默认编码是 <strong>latin-1</strong> 还是 <strong>utf-8</strong> 啊喂…后面会通过捣鼓 <strong>Qt</strong>，来验证说，<strong>QString</strong> 的默认编码应该不是这里说的 <strong>latin-1</strong>，而应该是 <strong>UTF</strong>，至于是不是 <strong>utf-8</strong>，我就不太确定了，后面会说。还有，就是说 <strong>Qt5</strong> 之后其实不会让你遇到乱码的情况的，你随便写随便就不会有乱码，除非，就像我们踩到下面要说的这个坑一样，我们就奇迹般地遇到乱码了。</font><br><br>　　如果使用的是 <strong>MSVC2005/2008/2010</strong>，可能无法使用 <strong>utf8</strong> 编码，于是下面的代码<br>　　　QString s1 = “我是中文”;<br>　　　QString s2(“我是中文”);<br>　　　QString s3 = QObject::tr(“我是中文”);<br>　　将不会工作。因为<font color="green">从 <strong>MSVC2005</strong> 起，你无法给编译器设置字符串要使用的编码。尽管 2003 之前，也无法设置，但是它会遵循源码文件的编码；而 2005 就自作聪明了，即使你源码文件保存成 <strong>不带BOM的utf8</strong>，它都会试图帮你转换一下</font>。<br>　　<font color="#D3442D">下面 <a href="#vs2013">捣鼓一下 <strong>VS 2013</strong> </a>那部分会为大家充分说明这个，这里先解释一下，其实就是：<br/><br>　　　　1. <strong>VS</strong> 的 <strong>cl</strong> 编译器可不管你的源文件是什么编码格式，反正不乱码，编译器能读出来内容就行。那怎么读，也许你会问，无非就是通过各种编码方式的一些标记，其实很多时候就是 <strong>BOM</strong> 来识别，或者，像那种<strong>不带BOM</strong> 的 <strong>UTF-8</strong> 那样，他并不知道是什么，就笼统的用 <strong>ANSI</strong>（应该就是 <strong>GBK</strong>）解码，反正一般死不了，因为语言标识符都是英文字母，那就是 <strong>ASCII</strong> 嘛，<strong>utf-8</strong> 兼容 <strong>ASCII</strong>，<strong>GBK</strong> 也兼容，那就是一样一样的，无所谓。其他的不就是汉字注释，或者包含汉字的字符串嘛，注释对编译器又没什么卵用，至于包含汉字的字符串，那就，你源文件是什么字节数据我就照单收，我编译器读源文件本来就可以知道你一个字节一个字节是什么，我想大概是这样子的。<br>　　　　2. 这种他按照一个字节一个字节来也许是幸福的，因为他不知道你是什么，不敢乱改造你，这就带来，你字符串内存中的数据和你本来的字节数据会是一样的，编译器采用的编码方式并没影响。但是，那种他知道你内容的，比如说带 <strong>BOM</strong> 的 <strong>UTF-8</strong>，人家知道你三个字节的数据是一个汉字，他就自作聪明按照自己的编码方式（下面你会知道是 <strong>GBK</strong>）来处理，那么内存中就是这个汉字对应的两个字节的数据了（<strong>GBK</strong> 的话，而且这里只说常用字，也就是 <strong>BMP</strong> 之内的汉字，什么是 <strong>BMP</strong>，后续你就知道了），他处理什么的时候就变成两个字节了，比如输出到 <strong>console</strong>，这个还好，<strong>Window</strong> 下的 <strong>console</strong> 也几乎都是 <strong>GBK</strong> 的；输出到 <strong>UI</strong> 呢？就比如我们输出给 <strong>UTF-8</strong> 编码的 <strong>Qt</strong> 界面，结果就跪了，而且这个 <strong>UI</strong> 界面还不让改编码（我用 <strong>NotePad++</strong> 在 <strong>Qt Creator</strong> 外面动手脚，结果不是 <strong>UTF-8</strong> 编码的直接不让读！！可以的话，改成 <strong>GBK</strong> 估计会通)…<strong>GBK</strong> 的字节数据按照 <strong>UTF-8</strong> 来解码，造不出几个奇怪的字来，只会是一个字节就一个未知符(就像上面运行界面截图中的乱码)。</font><br></font></div>

<p>　　上文中提到的 <strong>QString::fromXXX</strong> 正是乱码问题的一个解决方案：<br>　　　　<strong>QString::fromLocal8Bit(“xxxx…”);</strong><br>　使用 <strong>fromLocal8Bit</strong> 对包含中文汉字的 <strong>窄字符串</strong> 进行处理。</p>
<p>　另外一个解决方案则是使用如下的预编译头修改执行字符集。本文后续部分会回顾并分析这两个解决方案。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*  </div><div class="line"> *  建议放置在源文件，放置在头文件好像每次都必须重新保存源文件才对源文件有影响</div><div class="line"> *  这个好像跟 C++ 预编译头 原理有关...</div><div class="line"> */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> QT_VERSION &gt;= QT_VERSION_CHECK(5,0,0)</span></div><div class="line">    <span class="meta">#<span class="meta-keyword">if</span> defined(_MSC_VER) &amp;&amp; (_MSC_VER &gt; 1600)</span></div><div class="line">        <span class="comment">// Coding: UTF-8</span></div><div class="line">        <span class="meta">#<span class="meta-keyword">pragma</span> execution_character_set(<span class="meta-string">"utf-8"</span>)</span></div><div class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure></p>
<h2 id="捣鼓一下VS-2013"><a href="#捣鼓一下VS-2013" class="headerlink" title="捣鼓一下VS 2013"></a><font color="#F40D64"><span id="vs2013">捣鼓一下VS 2013</span></font></h2><p>　　按照上述的方法确实把问题解决了，但是，为什么可以呢？ <strong>No Zuo No Die</strong>，可还是要 <strong>try</strong> 一 <strong>try</strong> 呀。想到这里的环境是基于 <strong>MSVC2013</strong>，隔着一层弄可能弄不出什么名堂，干脆先在纯生的 <strong>VS2013</strong> 上面捣鼓一下，看能不能看出点眉目。以下几个实验参考 <strong>开源中国社区</strong> <a href="http://www.oschina.net/question/179574_103974#answers">《Qt 5 中文显示问题》</a>。</p>
<p>　　　<font color="#D3442D" size="4"><strong>实验原理</strong></font><br>　　1. <strong>VS2013</strong> 如何修改源代码的编码方式：<br>　　　菜单栏 <strong>文件</strong> –&gt; <strong>高级保存选项</strong> –&gt; <strong>编码</strong>，对编码方式进行修改，然后保存即可生效。我这里默认的编码是 <strong>简体中文(GB2312) - 代码页936</strong>，涉及的编码主要是 <strong>Unicode(UTF-8 带签名) - 代码页65001、Unicode(UTF-8 无签名) - 代码页65001</strong> （还是那句话，<strong>GB2312</strong> 啊、<strong>Unicode</strong> 啊、<strong>代码页</strong> 啊后续会讲）。<br>　　2. 简体中文系统的本地编码(这里不严格的区分了，你可以看看这个<a href="http://www.crifan.com/files/doc/docbook/char_encoding/release/htmls/ansi_encoding.html">《2.6.6. 为何”ANSI编码”（在Windows中）被称为”本地编码”》</a>)是 <strong>GBK，代码页936</strong>；繁体中文系统则是 <strong>Big5，代码页950</strong>。<br>    <center><img src="/img/programPearls/encoding/ANSI-GBK.png" width="360px" style="float: left"/><img src="/img/programPearls/encoding/ANSI-Big5.png" width="360px"/></center><br>　　　<font color="#D3442D" size="4"><strong>实验(1)、默认(简体中文 GB2312 )编码格式的源代码</strong></font><br>　　新建普通的<strong> Win32 控制台应用程序</strong>，主函数所在源文件代码如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// executionEncoding.cpp : 定义控制台应用程序的入口点。</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdafx.h"</span></span></div><div class="line">  </div><div class="line"><span class="keyword">int</span> _tmain(<span class="keyword">int</span> argc, _TCHAR* argv[])</div><div class="line">&#123;</div><div class="line">  <span class="comment">/*</div><div class="line">   * Unicode 的码点分别是(十进制)： 中(20013)，文(25991)。</div><div class="line">   * UTF8 编码分别(16进制): 中(E4B8AD)，文(E69687)。</div><div class="line">   * GBK 编码16进制(GBK内码)分别是： 中(D6D0)，文(CEC4)。</div><div class="line">   * Unicode(UTF-16) 编码: 中(2d4e)，文(8765)。</div><div class="line">   * Big5编码： 中(A4A4)，文(A4E5)。</div><div class="line">   */</span></div><div class="line">  <span class="comment">// 不能写成：const char str* = "中文"; 这样变成sizeof(指针)了，大小就一直是4了(我的64位机子)</span></div><div class="line">  <span class="keyword">const</span> <span class="keyword">char</span> str[] = <span class="string">"中文"</span>;</div><div class="line">  </div><div class="line">  <span class="comment">// 数组的sizeof值等于数组所占用的内存字节数，-1去掉'\0'。</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(str) - <span class="number">1</span>; ++i)&#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"0x%02x "</span>, str[i] &amp; <span class="number">0xFF</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, str);</div><div class="line">  <span class="comment">// Output:			</span></div><div class="line">  <span class="comment">// 0xd6 0xd0 0xce 0xc4</span></div><div class="line">  <span class="comment">// 中文</span></div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><font color="red"><strong>分析： </strong></font><br>　　1. 所谓的默认编码(这里是指文件的默认编码)是 <strong>GB2312</strong>，实际上跟 <strong>GBK</strong> 不差啦，就认是 <strong>GB</strong> 的编码吧，和本地编码一致。<br>　　2. 没有编译错误也没有警告，输出也和源代码一致(你可以用 <strong>NotePad++</strong> 看一下)： <strong>“0xd6 0xd0 0xce 0xc4”</strong>，打印字符也能解码： <strong>“中文”</strong>。</p>
<p>　　　<font color="#D3442D" size="4"><strong>实验(2)、UTF-8 (带签名)格式的源代码</strong></font><br>　　代码不变，编码改为 <strong>Unicode(UTF-8 带签名) - 代码页65001</strong>，保存。<br/><font color="red"><strong>分析： </strong></font><br>　　1. 没有编译错误也没有警告，但是输出有问题： <strong>“0xd6 0xd0 0xce 0xc4”</strong>，还是和上面的一样，源文件明明是  <strong>UTF-8</strong> 编码的格式： <strong>“0xe4 0xb8 0xad 0xe6 0x96 0x87”</strong>，怎么变成了 <strong>“0xd6 0xd0 0xce 0xc4”</strong> (这个是”中文”的 <strong>GBK</strong> 编码)？<br>　　2. 长度也不对呀，应该是 6 个字节，怎么变成 4 个字节了呢？<br>　　3. 打印字符也能解码： <strong>“中文”</strong>，这不和上面的一个一个样嘛…奇了个怪了。</p>
<p>　　　<font color="#D3442D" size="4"><strong>实验(3)、UTF-8 (无签名)格式的源代码</strong></font><br>　　代码不变，编码改为 <strong>Unicode(UTF-8 无签名) - 代码页65001</strong>，保存。<br/><font color="red"><strong>分析： </strong></font><br>　　1. 没有编译错误但是有警告 <strong>“warning C4819: 该文件包含不能在当前代码页(936)中表示的字符。请将该文件保存为 Unicode 格式以防止数据丢失”</strong>，潜台词就是，你这个代码有 <strong>GBK</strong>（代码页 936，见上图）不能表示的字符，请用 <strong>Unicode</strong> 方式保存。<strong>cl</strong> 编译器根本就没把源代码当作 <strong>UTF-8</strong> 处理，只是把它按照 <strong>GBK</strong> 编码方式处理罢了。<br>　　2. 不过输出和源代码是一致的： <strong>“0xe4 0xb8 0xad 0xe6 0x96 0x87”</strong> (这个是”中文”的 <strong>UTF-8</strong> 编码)。长度也是 6 个字节，这和源代码是一致的！<br>　　3. 但是（ <strong>Everything has a but</strong> ），打印字符乱码了，输出是： <strong>“涓枃”</strong>，这是什么鬼…</p>
<p>　　　<font color="#D3442D" size="4"><strong>实验(4)、使用 #pragma execution_character_set(“UTF-8”) 预编译头</strong></font><br>　　在源代码使用 <code>#pragma execution_character_set(&quot;UTF-8&quot;)</code> 预编译头：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// executionEncoding.cpp : 定义控制台应用程序的入口点。</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdafx.h"</span></span></div><div class="line">  </div><div class="line"><span class="comment">// 目前只能带参数"UTF-8"，其他似乎不支持</span></div><div class="line"><span class="meta">#<span class="meta-keyword">pragma</span> execution_character_set(<span class="meta-string">"UTF-8"</span>)</span></div><div class="line">  </div><div class="line"><span class="keyword">int</span> _tmain(<span class="keyword">int</span> argc, _TCHAR* argv[])</div><div class="line">&#123;</div><div class="line">  <span class="comment">/*</div><div class="line">   * Unicode 的码点分别是(十进制)： 中(20013)，文(25991)。</div><div class="line">   * UTF8 编码分别(16进制): 中(E4B8AD)，文(E69687)。</div><div class="line">   * GBK 编码16进制(GBK内码)分别是： 中(D6D0)，文(CEC4)。</div><div class="line">   * Unicode(UTF-16) 编码: 中(2d4e)，文(8765)。</div><div class="line">   * Big5 编码： 中(A4A4)，文(A4E5)。</div><div class="line">   */</span></div><div class="line">  <span class="comment">// 不能写成：const char str* = "中文"; 这样变成sizeof(指针)了，大小就一直是4了(我的64位机子)</span></div><div class="line">  <span class="keyword">const</span> <span class="keyword">char</span> str[] = <span class="string">"中文"</span>;</div><div class="line">  </div><div class="line">  <span class="comment">// 数组的sizeof值等于数组所占用的内存字节数，-1去掉'\0'。</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(str) - <span class="number">1</span>; ++i)&#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"0x%02x "</span>, str[i] &amp; <span class="number">0xFF</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, str);</div><div class="line">  <span class="comment">// Output:			</span></div><div class="line">  <span class="comment">// 0xd6 0xd0 0xce 0xc4</span></div><div class="line">  <span class="comment">// 中文</span></div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　重复试验(1)~(3)，试验结果如下：</p>
<center><table border="3" cellpadding="4px" style="font-family: verdana,arial,sans-serif; font-size:18px; color:#333333; background-color:#c3dde0; margin: 0; border-color: #333333; border-collapse:collapse; width: 840px"><tr><td style="width: 15%; text-align: center"><strong>源文件编码方式</strong></td><td style="width: 40%; text-align: center"><strong>试验结果</strong></td></tr><tr><td style="text-align: center">默认编码</td><td style="text-align: center">编译无错误无警告，输出： <strong>“0xe4 0xb8 0xad 0xe6 0x96 0x87”</strong> (这个是 <strong>“中文”</strong> 的 <strong>UTF-8</strong> 编码)，和源代码不一致；打印字符出现乱码，输出是： <strong>“涓枃”</strong></td></tr><tr><td style="text-align: center"><strong>UTF-8</strong> (带签名)</td><td style="text-align: center">编译无错误无警告，输出： <strong>“0xe4 0xb8 0xad 0xe6 0x96 0x87”</strong> (这个是 <strong>“中文”</strong> 的 <strong>UTF-8</strong> 编码)，和源代码一致；打印字符出现乱码，输出是： <strong>“涓枃”</strong>；输出结果与上一种情况一致</td></tr><tr><td style="text-align: center"><strong>UTF-8</strong> (无签名)</td><td style="text-align: center">编译无错误，还是报 <strong>“warning C4819: 该文件包含不能在当前代码页(936)中表示的字符。请将该文件保存为 Unicode 格式以防止数据丢失”</strong> 这个警告，输出： <strong>“0xe6 0xb6 0x93 0xee 0x85 0x9f 0xe6 0x9e 0x83”</strong> (这个是 <strong>“涓枃”</strong> 的 <strong>UTF-8</strong> 编码)，和源代码相差甚大；打印字符出现乱码，输出是： <strong>“娑擃厽鏋?”</strong></td></tr></table></center>


<p><font color="red"><strong>分析： </strong></font><br>　　1. 可以借助各种在线查看工具查看字符编码情况，这里使用 <a href="http://www.mytju.com/classcode/tools/encode_utf8.asp">查看字符编码（UTF-8）</a>或者 <a href="http://www.qqxiuzi.cn/bianma/zifuji.php">汉字字符集编码查询</a>。<br>　　2. 目前这个预编译头好像只能带参数 <strong> “UTF-8”</strong>，其他似乎不支持…我试过 <strong> “UTF-16”</strong>，报了这样一个警告 <strong>warning C4695: #pragma execution_character_set: ‘UTF-16’ 不是受支持的参数:  当前仅支持”UTF-8”</strong>。</p>
<p>　　3. 我们可以在 <strong>CMD窗口右键</strong> -&gt; <strong>属性</strong> -&gt; <strong>选项</strong>，查看到用于打印的窗口的编码方式，实际上就是前面所述的本地编码，实验(1)~(4)均在简体中文系统下进行，本地编码是 <strong>GBK</strong>。此处可以知道：上述窗口打印的字符，实际上就是对前面输出字节按照 <strong>GBK</strong> 解码的输出结果。假如输出的是 <strong>UTF-8</strong> 编码，显然按照 <strong>GBK</strong>  无法解码出原有汉字，所以出现了乱码。例如：输出的 <strong>“涓枃”</strong> 的 <strong>GBK</strong> 编码正是 <strong>“0xe4 0xb8 0xad 0xe6 0x96 0x87”</strong>。</p>
<p>　　4. 虽然<font color="green">添加了预编译头，但是报的 <strong>warning</strong> 还是一样的，<strong>cl</strong> 编译器还是没把不带签名的源代码当作 <strong>UTF-8</strong> 处理，还是按照 <strong>GBK</strong> 编码方式处理</font>了。</p>
<p>　　　<font color="#D3442D" size="4"><strong>实验(5)、切换成繁体中文系统</strong></font><br>　　将系统从简体中文切换至繁体中文，可以参考 <a href="http://durant35.github.io/2016/02/02/System_Win8.1%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87%E7%B3%BB%E7%BB%9F%E5%88%87%E6%8D%A2%E5%88%B0%E7%B9%81%E4%BD%93%E4%B8%AD%E6%96%87%E7%B3%BB%E7%BB%9F/#more">《Win8.1简体中文系统切换到繁体中文系统》</a>，重复试验(1)~(4)。实验结果如下表：</p>
<center><table border="3" cellpadding="4px" style="font-family: verdana,arial,sans-serif; font-size:18px; color:#333333; background-color:#c3dde0; margin: 0; border-color: #333333; border-collapse:collapse; width: 840px"><tr><td style="width: 20%; text-align: center"><strong>源文件编码方式</strong></td><td style="width: 40%; text-align: center"><strong>试验结果</strong></td></tr><tr><td style="text-align: center"><strong>GB2312</strong> 编码，无预编译头</td><td style="text-align: center">编译无错误无警告，输出： <strong>“0xd6 0xd0 0xce 0xc4”</strong>(这个是 <strong>“中文”</strong> 的 <strong>GBK</strong> 编码)，和源代码一致；打印字符出现乱码： <strong>“笢恅”</strong></td></tr><tr><td style="text-align: center"><strong>UTF-8</strong> (带签名)，无预编译头</td><td style="text-align: center">编译无错误无警告，输出： <strong>“0xa4 0xa4 0xa4 0xe5”</strong>(这个是 <strong>“中文”</strong> 的 <strong>Big5</strong> 编码)，和源代码不一致；打印字符不出现乱码</td></tr><tr><td style="text-align: center"><strong>UTF-8</strong> (无签名)，无预编译头</td><td style="text-align: center">编译无错误，报 <strong>“warning C4819: 该文件包含不能在当前代码页(950)中表示的字符。请将该文件保存为 Unicode 格式以防止数据丢失”</strong>，输出是： <strong>“0xe4 0xb8 0xad 0xe6 0x3f”</strong>（<strong>“Big5编码：e4b8(銝)ade6(剜)9687(未知)；GBK编码：e4b8(涓)ade6(非法)9687(枃)”</strong>），和源代码不一致；打印字符出现乱码： <strong>“銝剜?”</strong></td></tr><tr><td style="text-align: center"><strong>GB2312</strong> 编码，带预编译头</td><td style="text-align: center">编译无错误无警告，输出： <strong>“0xe7 0xac 0xa2 0xe6 0x81 0x85”</strong>(这个是 <strong>“笢恅”</strong> 的 <strong>UTF-8</strong> 编码)，和源代码不一致；打印字符也出现乱码： <strong>“蝚Ｘ?”</strong></td></tr><tr><td style="text-align: center"><strong>UTF-8</strong>（带签名），带预编译头</td><td style="text-align: center">编译无错误无警告，输出： <strong>“0xe4 0xb8 0xad 0xe6 0x96 0x87”</strong>（这个是 <strong>“中文”</strong> 的<strong>UTF-8</strong>编码），和源代码一致；打印字符出现乱码： <strong>“銝剜?”</strong></td></tr><tr><td style="text-align: center"><strong>UTF-8</strong>（无签名），带预编译头</td><td style="text-align: center">编译无错误，报 <strong>“warning C4819: 该文件包含不能在当前代码页(950)中表示的字符。请将该文件保存为 Unicode 格式以防止数据丢失”</strong>，输出是： <strong>“0xe9 0x8a 0x9d 0xe5 0x89 0x9c 0x3f</strong>（这个是 <strong>“銝剜?”</strong> 的 <strong>UTF-8</strong> 编码），和源代码不一致；打印字符出现乱码： <strong>“???”</strong></td></tr></table></center>

<p><font color="red"><strong>分析： </strong></font><br>　　1. 繁体中文系统下默认编码似乎是：<strong>Unicode-代码页1200</strong>，为了与前面实验对比，这里需要修改为 <strong>简体中文(GB2312) - 代码页936</strong>。<br>　　2. 因为切换成繁体中文系统，可以查看到用于<font color="green">打印的 <strong>Console窗口</strong> 的编码方式虽然还是本地编码，但已经变成 <strong>Big5(大五码)</strong></font>。所以，上述窗口打印的字符，变成是对前面输出字节按照 <strong>Big5</strong>（不再是简体中文系统下的 <strong>GBK</strong> 了）解码的输出结果。而对于 <strong>UTF-8</strong> 编码或者是 <strong>GBK</strong> 编码，按照 <strong>Big5</strong> 编码还是无法解码出原有汉字，所以还是出现了乱码。</p>
<p>　　3. 为什么有的字节变成 <strong>“”</strong>，有的字节变成 <strong>“?”</strong> 呢？大致查了一下，<font color="blue"><strong>Big5</strong> 编码：”高位字节”使用了 <strong>0x81-0xFE</strong>，”低位字节”使用了 <strong>0x40-0x7E</strong>，及 <strong>0xA1-0xFE</strong>；而 <strong>GBK</strong> 编码：首字节在 <strong>0x81-0xFE</strong> 之间，尾字节在 <strong>0x40-0xFE</strong> 之间，剔除 <strong>0x??7F</strong> 一条线</font>。对比上面出现的 <strong>“”</strong>、<strong>“?”</strong>，你会发现，那些解码成 <strong>“?”</strong> 的，其字节数据均在合法范围内，只是对应的字符还未定义；而那些解码成 <strong>“”</strong>，其字节数据不全在合法范围内，属于非法字符。</p>
<p>　　4. 通过报的 <strong>warning</strong> 可以看出，<strong>cl</strong> 编译器还是没把不带签名的源代码当作 <strong>UTF-8</strong> 处理，不过并不是像在简体中文系统下按照 <strong>GBK</strong> 编码方式处理，而是按照 <strong>Big5</strong> 编码方式(代码页950)。</p>
<p>　　5. 结合前面的实验可知：加了预编译头之后，有点像先按照没加预编译头处理的结果再转换成 <strong>UTF-8</strong>。更准确地说，编译过程中，<strong>cl</strong> 编译器按照 <strong>Big5</strong> 或者 <strong>GBK</strong> 编码方式（分别对应繁体和简体中文系统，这里感觉说成 <strong>ANSI</strong> 更好）解码，如果添加了预编译头，再把解码的结果转化为 <strong>UTF-8</strong> 编码。最终解码结果即是汉字在内存中的保存方式（ <strong>GBK/Big5</strong> 为 2 个字节，<strong>UTF-8</strong> 一般为 3 个字节）。</p>
<p>　　6. 通过前面的实验，也可以大概猜测到，上述过程中，假如编译器按照 <strong>ANSI</strong> 解码，遇到非法字符（如简体中文系统下的 <strong>“涓枃”</strong> 中的 <strong>“0xad 0xe6”</strong>）或者未定义字符（如繁体中文系统下的 <strong>“銝剜?”</strong> 中的 <strong>“0x96 0x87”</strong>）：<font color="green">对于非法字符，保留原有字节数据；对于未定义字符，则有可能变成了 <strong>“?”(0x3f)</strong></font>。<font color="blue">而当这些情况发生时，<strong>cl</strong> 编译器发现这些字节数据并不是 <strong>ANSI</strong> 编码能表达的合理方式，因此也就出现了那个 <strong>C4819 编译警告</strong></font>。</p>
<p>　　7. 至于源文件的编码方式，实际上和上述过程没有联系，只是 <font color="green"><strong>cl</strong> 编译器不认得 <strong>UTF-8(无签名)</strong>，如果遇到这种编码方式保存的文件，会按照默认编码方式，即 <strong>ANSI</strong> 对源文件进行解码</font>。你可能会惊讶： <strong>Big5</strong> 不是有一点点不兼容 <strong>ASCII</strong> 吗?还好上面代码中的 <strong>keyword</strong> 都能准确解码。</p>
<p>　　8. 上述试验中，有些结果似乎与上述结论相违背，比如：实验(3)中输出结果： <strong>“0xe4 0xb8 0xad 0xe6 0x96 0x87”</strong>，这个确实是 <strong>“中文”</strong> 的<strong>UTF-8</strong> 编码。但是如果如上述结论所述，不是会被按照 <strong>GBK</strong> 解码成其他字符吗？字节数据应该会变的呀。又比如：实验(5)，源文件编码方式是 <strong>GB2312编码，无预编译头</strong>，怎么它的输出还是 <strong>“中文”</strong> 的 <strong>GBK</strong> 编码，不是会被按照 <strong>Big5</strong> 解码成其他字符吗？。反正就是这种输出和源文件编码一致的情况，令人摸不着头脑。对于这种情况，通过对比加没加预编译头，你就会发现，<font color="blue">虽然输出和源文件编码一致，但是对于程序来说，已经不是原先我们输入的 <strong>“中文”</strong> 字面值了，只是这些字节数据在这些 <strong>ANSI</strong> 编码中既不非法也不是未知字符，恰巧能表示另一个字符罢了</font>。带编译头的输出结果完全能说明这一点。</p>
<p>　<font color="#D3442D" size="4"><strong>实验(1)~(5)总结分析</strong></font><br>　　1. 使用繁体中文系统的情况属于少数，我们了解就好。<br>　　2. 简体中文系统，编码方式按照默认就行，源文件保存是 <strong>GBK</strong>（更准确说是 <strong>GB2312</strong>），编译器解码是 <strong>GBK</strong>，<strong>console(CMD)</strong> 窗口编码也是 <strong>GBK</strong>。<br>　　3. 如果涉及跨平台，<strong>UTF-8(无签名)</strong> 估计是没戏了（<strong>UTF-8</strong> 本来就不需要 <strong>BOM</strong>，<strong>Linux</strong> 默认编码好像就是这个)，会被 <strong>cl</strong> 编译器自作主张，那就使用 <strong>UTF-8(带签名)</strong>，不过需要添加预编译头 <code>#pragma execution_character_set(&quot;UTF-8&quot;)</code>，这一句的作用是，将 <font color="green"><strong>执行字符集</strong> 修改为  <strong>“UTF-8”</strong>。这里你也知道，不加的话，简体中文系统下估计这个 <strong>执行字符集</strong> 缺省就是 <strong>GBK</strong></font> 了。</p>
<h2 id="捣鼓一下基于VS2013构建套件的Qt"><a href="#捣鼓一下基于VS2013构建套件的Qt" class="headerlink" title="捣鼓一下基于VS2013构建套件的Qt"></a><font color="#F40D64">捣鼓一下基于VS2013构建套件的Qt</font></h2><p>　　捣鼓完 VS2013 之后，带着上述得出的结论，再来捣鼓 <strong>Qt5.5 MSVC2013</strong>，思路就清晰多了。新建 <strong>Qt Console Application</strong>，<strong>main.cpp</strong> 代码如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//#pragma execution_character_set("utf-8")</span></div><div class="line">  </div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QCoreApplication&gt;</span></span></div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></div><div class="line"></span>&#123;</div><div class="line">  <span class="function">QCoreApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</div><div class="line">  </div><div class="line">  <span class="keyword">const</span> <span class="keyword">char</span> str[] = <span class="string">"中文"</span>;</div><div class="line">  </div><div class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(str)<span class="number">-1</span>; i++) &#123;    <span class="comment">// -1除去'\0'</span></div><div class="line">      <span class="built_in">printf</span>(<span class="string">"0x%02x "</span>, str[i]&amp;<span class="number">0xFF</span>);</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="built_in">printf</span>(<span class="string">"\n%s\n"</span>, str);</div><div class="line">  <span class="comment">// 简体中文系统Output:</span></div><div class="line">  <span class="comment">// 0xe4 0xb8 0xad 0xe6</span></div><div class="line">  </div><div class="line">  <span class="comment">// 繁体中文系统Output:</span></div><div class="line">  <span class="comment">// A4 A4 A4 E5</span></div><div class="line">  <span class="keyword">return</span> a.exec();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>实验结果如下：<br>　<font color="blue"><strong><1>、 </strong></font>按 <strong>编码<font color="green">[System]</font>保存</strong> → <strong>Build</strong> → <strong>Run</strong>，结果是：<strong>“0xd6 0xd0 0xce 0xc4”</strong>，打印字符不出现乱码：<strong>“中文”</strong>；<br>　<font color="blue"><strong><2>、 </strong></font>预设<strong>UTF-BOM</strong> 选项：<strong>如果编码是UTF-8则添加</strong>，按 <strong>编码<font color="green">[UTF-8]</font>保存</strong> → <strong>Build</strong> → <strong>Run</strong>，结果也是：<strong>“0xd6 0xd0 0xce 0xc4”</strong>，打印字符不出现乱码：<strong>“中文”</strong>；<br>　<font color="blue"><strong><3>、 </strong></font>预设<strong>UTF-BOM</strong> 选项：<strong>总是删除</strong>，按 <strong>编码<font color="green">[UTF-8]</font>保存</strong> → <strong>Build</strong> → <strong>Run</strong>，结果是：<strong>“0xe4 0xb8 0xad 0xe6 0x96 0x87”</strong>，打印字符出现乱码：<strong>“涓枃”</strong>；<br>　<font color="blue"><strong><4>、 ······</strong></font><br>　<font color="blue"><strong><5>、 </strong></font>实验结果和上面一节 <font color="#F40D64"><strong>《捣鼓一下VS 2013》</strong></font> 其实是完全一致的！这也不奇怪，本身用的就是同一个编译器，编译运行环境应该是一致的。</p>
<p>唯一的区别可能就是：<br>　假如是一个 <font color="green"><strong>Qt Widgets Application</strong> 工程，源文件按照 <strong>不带BOM 的UTF-8</strong> 保存，不仅仅只是简单的一个编译警告，而是还会出现像 <font color="#F40D64"><strong>《解决方案》</strong></font> 一节开头说的那个令人大跌眼镜的错误：<font color="#E36565"><strong>error: C2001</strong>: 常量中有换行符</font> ！！</font><br>    <center><img src="/img/programPearls/encoding/noBOM_error.jpg"/></center></p>
<p>　<font color="#D3442D" size="4"><strong>问题透析，再捣鼓</strong></font><br>　　在已经有了上述经验的基础上，我们重新回顾一下前面提出的问题。发现我们似乎忽略了一个地方，那就是 <strong>隐式类型转换</strong>！<br>　　<strong><code>setTabText</code></strong> 的函数原型是：<strong>setTabText (int index, const QString &amp; label)</strong>，所以这里是不是应该存在一个 <strong>字符串</strong> 转 <strong>QString</strong> 的过程呢？从这篇文章 <a href="http://blog.csdn.net/brave_heart_lxl/article/details/7186631">《qt中文乱码问题》</a> 我们明确以下概念：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">明确概念0：</div><div class="line">　　"我是汉字" 是C语言中的字符串，它是char型的窄字符串。</div><div class="line">  </div><div class="line">明确概念1：</div><div class="line">　　源文件是有编码的，但是这种纯文本文件却不会记录自己采用的编码</div><div class="line">  </div><div class="line">明确概念2：</div><div class="line">　　如同我们都了解的'A'与'\x41'等价一样。</div><div class="line">　　GBK编码下的</div><div class="line">　　　　const char * str = "我是汉字";　　等价于</div><div class="line">　　　　const char * str = "\xce\xd2\xca\xc7\xba\xba\xd7\xd6";</div><div class="line">  </div><div class="line">　　当用UTF-8编码时，等价于</div><div class="line">　　　　const char * str = "\xe6\x88\x91\xe6\x98\xaf\xe6\xb1\x89\xe5\xad\x97";</div><div class="line">注意：这个说法不全对，比如保存成带BOM的UTF-8，用cl编译器时，汉字本身是UTF-8编码，但程序内保存时却是对应的GBK编码。</div></pre></td></tr></table></figure></p>
<p>　　所以，此处存在 <strong>const char*</strong> 到 <strong>QString</strong> 隐式类型转化的过程，另外，通过上面的捣鼓，我们很容易理解 <font color="red"><strong>注意</strong></font> 部分的内容：执行字符集确定了上述 <strong>窄字符串</strong> 在内存中的编码方式，说到底，内存中保存的都是 <strong>01010…</strong>，是通过执行字符集解码获得的。</p>
<p>　　另外，从这里 <a href="http://www.cnblogs.com/findumars/p/4011848.html">《QString够绕的，分为存储(编译器)和解码(运行期)，还有VS编译器的自作主张，还有QT5的变化》</a> 了解到 <strong>QString</strong> 分为 <strong>存储(编译器)</strong> 和 <strong>解码(运行期)</strong>，由于我们的隐式类型转化显然发生在运行期，也就是通过  <strong>窄字符串</strong> 参数提供的字节数据构造 <strong>QString</strong>，那么他使用的解码方式是？我们通过下面代码进行测试：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ui-&gt;tabWidget-&gt;setTabText(<span class="number">0</span>, <span class="string">"\xe4\xb8\xad\xe6\x96\x87"</span>);   <span class="comment">// UTF-8 编码序列</span></div><div class="line">ui-&gt;tabWidget-&gt;setTabText(<span class="number">1</span>, <span class="string">"\xd6\xd0\xce\xc4"</span>);           <span class="comment">// GBK 编码序列</span></div><div class="line">ui-&gt;tabWidget-&gt;setTabText(<span class="number">2</span>, <span class="string">"\xA4\xA4\xA4\xE5"</span>);           <span class="comment">// Big5 编码序列</span></div><div class="line">ui-&gt;tabWidget-&gt;setTabText(<span class="number">3</span>, <span class="string">"\x4e\x2d\x65\x87"</span>);           <span class="comment">// UTF-16 编码序列</span></div></pre></td></tr></table></figure></p>
<p>　　运行结果如下图：<br>    <img src="/img/programPearls/encoding/QString_encoding.png"/><br>　　所以此处大胆推测，上述隐式类型转化过程，会通过调用 <strong>QString::fromUtf8(“xxx…”)</strong> 动态构造 <strong>QString</strong>，至此，就不难解释前面出现的乱码问题和相应的解决方案了！</p>
<p>　　<strong>乱码问题原因：</strong> <strong>cl</strong> 编译器的默认执行字符集是 <strong>GBK</strong>，这造成不管你的源码文件是哪一种编码方式（<strong>cl</strong> 编译器不能识别不带 <strong>BOM</strong> 的 <strong>UTF-8</strong> 编码方式保存的文件，会按照默认的 <strong>GBK</strong> 编码方式解码源文件），编译时都会按照执行字符集对解码结果进行重新编码，而这就是数据（如这里的窄字符串）最终在内存中的存储形式！<br>　　另外，<strong>setTabText</strong> 函数存在一个 <strong>QString</strong> 的隐式构造过程，采用 <strong>UTF-8</strong> 编码方式动态解码，结果，原本按照 <strong>GBK</strong> 编码保存的字节数据被按照 <strong>UTF-8</strong> 编码进行解码，所以出现了乱码！</p>
<p>　　<strong>方案一思路：</strong> 因为默认情况下，是按照 <strong>GBK</strong> 编码对解码的数据进行编码的，也就是 <strong>QString</strong> 隐式构造过程中的字节数据是按照 <strong>GBK</strong> 编码的。所以，只要我们在构造 <strong>QString</strong> 采取正确的解码方式 <strong>GBK</strong>，就能正确构造 <strong>QString</strong> ，从而避免乱码。 <strong>QString::fromLocal8Bit ( const char * str, int size = -1 )</strong> 中的 <strong>local8Bit</strong> 在简体中文 <strong>Windows</strong> 下，是 <strong>GBK</strong>；在繁体中文 <strong>Windows</strong> 下，则是 <strong>Big5</strong>；所以实际上 <strong>local8Bit</strong> 对应的编码方式就是我们接下来会了解的 <strong>ANSI</strong> 编码。此外，上面漏说的一个是，从对 <strong>VS2013</strong> 的捣鼓结果来看，这个执行字符集更准确来说，也是 <strong>ANSI</strong> 编码，参考 <strong>简体中文/繁体中文</strong> 系统下的不同结果可以得出。<br>　　故，使用 <strong>QString::fromLocal8Bit ( const char * str, int size = -1 )</strong> 可以解决我们的乱码问题。而且，为了保证运行结果与源文件保持一致，我们的源文件编码方式也最好采用 <strong>GBK/GB2312</strong> 编码方式保存。</p>
<p>　　<strong>方案二思路：</strong> 另一种思路就是，既然 <strong>QString</strong> 的隐式构造过程中采用 <strong>UTF-8</strong> 编码方式动态解码，我们可不可以在编译时就把数据按照 <strong>UTF-8</strong> 编码方式进行保存呢？答案是可以的，就像我们从 <strong>VS2013</strong> 的捣鼓得到的结果一样，通过 <strong><code>#pragma execution_character_set(&quot;utf-8&quot;)</code></strong> 即可实现。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*  </div><div class="line"> *  建议放置在源文件，放置在头文件好像每次都必须重新保存源文件才对源文件有影响</div><div class="line"> *  这个好像跟 C++ 预编译头 原理有关...</div><div class="line"> */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> QT_VERSION &gt;= QT_VERSION_CHECK(5,0,0)</span></div><div class="line">    <span class="meta">#<span class="meta-keyword">if</span> defined(_MSC_VER) &amp;&amp; (_MSC_VER &gt; 1600)</span></div><div class="line">        <span class="comment">// Coding: UTF-8</span></div><div class="line">        <span class="meta">#<span class="meta-keyword">pragma</span> execution_character_set(<span class="meta-string">"utf-8"</span>)</span></div><div class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure></p>
<p>　　建议采用上述的参考代码，因为预编译头的使用涉及 <strong>Qt</strong> 版本（似乎大于 5.0 才有用），<strong>VS</strong> 版本（如上面所说，VS2005 以后）；此外留意上面的注释说明，即注意这部分预编译头在代码中的位置！！而且，为了保证运行结果与源文件保持一致，我们的源文件编码方式则最好采用 <strong>UTF-8</strong> 编码方式保存，而且必须 <strong>带 BOM</strong>。</p>
<p>　　最后，我们来讨论一下，为什么 <font color="green"><strong>Qt</strong> 中在 <strong>UI</strong> 设计过程中编辑的中文字符不会出现乱码的问题</font>。比如，你可以在 <strong>UI</strong> 设计时通过修改 <strong>QTabWidget</strong> 的 <strong>currentTabText</strong> 来设置选项卡标签，从而快速实现文章开头的代码功能。这里我们通过这种方式添加两个标签：<strong>调试助手</strong>、<strong>应用开发</strong>，你会发现，通过这种方式很容易就实现我们需要的功能！重要的是不会出现乱码！那这又是怎么实现的？或者说 <strong>Qt</strong> 工程是如何将 <strong>UI</strong> 界面的 <strong>XML</strong> 文件引入到工程的，毕竟我们的项目，或者说我们知道 <strong>Qt</strong> 最终都是通过 <strong>C++</strong> 来编译构建的。</p>
<p>　　实际上， <strong>Qt</strong> 在编译的过程中会自动使用一个叫 <font color="green"><strong>uic.exe</strong> 的工具（这个工具可以在<strong>“Qt根目录\5.5\msvc2013_64\bin”</strong> 找到）</font>将 <strong>UI</strong> 界面的 <strong>XML</strong> 文件转化为 <strong>.h</strong> 头文件，比如这里，<strong>mainwindow.ui</strong> 文件就被转化为 <strong>ui_mainwindow.h</strong> 文件，并在 <strong>mainwindow.cpp</strong> 中通过 <strong><code>#include &quot;ui_mainwindow.h&quot;</code></strong> 的方式引入。那究竟这个 <strong>ui_mainwindow.h</strong> 头文件长怎么样？怎样能够实现 <strong>UI</strong> 设计与执行代码分离，最后又能够整合在一起呢？<br>　　这个 <strong>ui_mainwindow.h</strong> 头文件似乎只是一个中间临时文件，在 <strong>工程目录</strong> 或者 <strong>生成目录</strong> 都找不到它的影子，需要我们手动生成，生成过程如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">手动生成ui文件对应类：</div><div class="line">　　ui文件只是一个xml文件，编译器是不认识的，所以qt做了一个uic.exe的工具，</div><div class="line">　　会将ui文件（xml）默认编译成ui_xxx.h（编译过程如下描述），</div><div class="line">　　这样编译器就能使用designer做出来的界面文件了，你在mainxxx.cpp中包含的头文件就是上面提到的ui_xxx.h，</div><div class="line">　　你可以打开这个文件看一下(右键 → Open Include Hierarchy → 打开ui_xxx.h)，</div><div class="line">　　其实就是用代码描述了你在disigner中画的界面。</div><div class="line">  </div><div class="line">　　命令：</div><div class="line">　　　　cd D:\Workspace\Qt Workspace\Demo			@进入界面文件 xxx.ui 所在目录</div><div class="line">　　　　d:						@通过此方式切换盘符</div><div class="line">　　　　<span class="built_in">set</span> path=S:\Qt\<span class="number">5.5</span>\msvc2013_64\bin;%path%		@把 uic.exe 路径追加到当前 CMD 的 path 中</div><div class="line">              @只对当前窗口有效</div><div class="line">　　　　uic mainwindow.ui &gt; ui_mainwindow.h 		@生成.ui 对应的.h 文件，并保存在 ui_xxx.h 文件中</div></pre></td></tr></table></figure></p>
<p>　　生成的 <strong>ui_xxx.h</strong> 头文件结构大致如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/********************************************************************************</div><div class="line">** Form generated from reading UI file 'mainwindow.ui'</div><div class="line">**</div><div class="line">** Created by: Qt User Interface Compiler version 5.5.1</div><div class="line">**</div><div class="line">** WARNING! All changes made in this file will be lost when recompiling UI file!</div><div class="line">********************************************************************************/</span></div><div class="line">  </div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> UI_MAINWINDOW_H</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> UI_MAINWINDOW_H</span></div><div class="line">  </div><div class="line"><span class="comment">// 此处有一系列 include，包括选项卡相关的 QtWidgets 等相关类</span></div><div class="line">...</div><div class="line">  </div><div class="line">QT_BEGIN_NAMESPACE</div><div class="line">  </div><div class="line"><span class="keyword">class</span> Ui_MainWindow</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// 界面中使用的一系列控件的成员声明，包括QWidget(选项卡主框架)、QTabWidget(选项卡标签)、QPushButton(按钮)</span></div><div class="line">    ...</div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setupUi</span><span class="params">(QMainWindow *MainWindow)</span></div><div class="line">    </span>&#123;</div><div class="line">        <span class="comment">// 成员变量的一系列初始化</span></div><div class="line">        ...</div><div class="line">  </div><div class="line">        retranslateUi(MainWindow);</div><div class="line">  </div><div class="line">        tabWidget-&gt;setCurrentIndex(<span class="number">0</span>);</div><div class="line">  </div><div class="line">        <span class="comment">// 信号槽机制！！</span></div><div class="line">        QMetaObject::connectSlotsByName(MainWindow);</div><div class="line">    &#125; <span class="comment">// setupUi</span></div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">retranslateUi</span><span class="params">(QMainWindow *MainWindow)</span></div><div class="line">    </span>&#123;</div><div class="line">        <span class="comment">// 主界面标题、按钮、选项卡标签等涉及中文汉字的转义</span></div><div class="line">        ...</div><div class="line">  </div><div class="line">        <span class="comment">// 下面是左右两个标签"调试助手"、"应用开发"的转义</span></div><div class="line">        tabWidget-&gt;setTabText(tabWidget-&gt;indexOf(tab), </div><div class="line">        QApplication::translate(<span class="string">"MainWindow"</span>, </div><div class="line">                                        <span class="string">"\350\260\203\350\257\225\345\212\251\346\211\213"</span>, <span class="number">0</span>));</div><div class="line">        tabWidget-&gt;setTabText(tabWidget-&gt;indexOf(tab_2), </div><div class="line">        QApplication::translate(<span class="string">"MainWindow"</span>, </div><div class="line">                                        <span class="string">"\345\272\224\347\224\250\345\274\200\345\217\221"</span>, <span class="number">0</span>));</div><div class="line">    &#125; <span class="comment">// retranslateUi</span></div><div class="line">  </div><div class="line">&#125;;</div><div class="line">  </div><div class="line"><span class="keyword">namespace</span> Ui &#123;</div><div class="line">    <span class="keyword">class</span> MainWindow: <span class="keyword">public</span> Ui_MainWindow &#123;&#125;;</div><div class="line">&#125; <span class="comment">// namespace Ui</span></div><div class="line">  </div><div class="line">QT_END_NAMESPACE</div><div class="line">  </div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// UI_MAINWINDOW_H</span></span></div></pre></td></tr></table></figure></p>
<p>　<strong>uic.exe</strong> 工具将我们设计的 <strong>UI</strong> 界面文件转化为一个相关的类，并以头文件的形式提供给主程序，这就是我们上面提到的转化过程。<font color="green">注意这里有关中文汉字的转义，使用的是一种叫做 <strong>“八进制转义序列”（Octal Escape Sequence）</strong>，<strong>ui</strong> 生成的 <strong>UTF8</strong> 是用  <strong>C</strong> 语言的转义字符实现的，<strong>VC</strong> 不会私下做手脚，因此是能显示的。</font>举个例子，<strong>“调试助手”</strong> 的 <strong>“调”</strong> 的 <strong>UTF-8</strong> 编码是： <strong><code>E8 B0 83</code></strong>，使用的是十六进制，换成八进制，正是： <strong><code>\350\260\203</code></strong>，其他汉字字符均是按照这种方式进行转义的。</p>
<p>　有这样的理解：<br>　　只要代码知道 <strong><code>&quot;\350\260\203\350\257\225\345\212\251\346\211\213&quot;</code></strong> 这段转义是按照什么编码转义的，那么不管到哪都能最后生成唯一的 <strong>Unicode</strong> 字符串。<br>　　因为，这段转义文本（不是转义前的文本）不管是用 <strong>gbk</strong> 还是 <strong>utf8</strong> 编码的，<strong>ascii</strong> 字符的编码是对应的，到哪看都是 <strong><code>&quot;\350\260\203\350\257\225\345\212\251\346\211\213&quot;</code></strong>，而不会变成乱码，而你要是直接写中文就不好说了；<br>　　或者说，为了 <font color="green">避免源码字符集不同而导致最后程序的字符集不同，那些在不同字符集中有歧义的非 <strong>ascii</strong> 字符就要转义成上面这种形式才可以避免</font>！<br>　　注意，假如你在界面文件中输入 <strong>ASCII</strong> 字符，是不会发生上面的转化的！！</p>
<p>　所以，<font color="green">我们也可以在代码中仿造这种方式，直接使用中文汉字的<strong>（Octal Escape Sequence）</strong>，不过，这样转化实在太麻烦了，你不觉得烦吗？要先获取 <strong>UTF-8</strong>编码，再转成八进制！</font>，建议还是理解上面所述的内容，这样你就能够顺利、清晰的解决乱码问题！</p>
<h2 id="说在前头的总结"><a href="#说在前头的总结" class="headerlink" title="说在前头的总结"></a><font color="#F40D64">说在前头的总结</font></h2><ol>
<li>我们大概可以猜测到乱码的原因：无非就是编码方式与解码方式不一致造成。但！编码方式体现在哪里？编译时采用的编码方式？解码方式又体现在哪里？运行时使用的动态解码方式？</li>
<li>各种编码方式是怎样的?为什么方式不一致就会出现乱码呢？那有什么办法可以避免?</li>
<li>借 <strong>Qt</strong> 中文乱码问题的分析，拉开我们有关字符编码系列的阐述，在接下来的三篇文章里面，将会尽可能多的为大家讲述 <strong>字符编码</strong> 的相关概念和问题分析，希望能帮助大家建立这一块的知识网络。</li>
</ol>
<h2 id="Version-Control"><a href="#Version-Control" class="headerlink" title="Version Control "></a><strong>Version Control</strong> <center><table border="3" cellpadding="4px" style="font-family: verdana,arial,sans-serif; font-size:18px; color:#333333; background-color:#c3dde0; margin: 0; border-color: #333333; border-collapse:collapse; width: 92%"></h2><p><tr><td style="width: 80px; text-align: center">版本号</td><td style="width: 150px; text-align: center">日期</td><td style="width: 330px; text-align: center">内容</td><td style="width: 120px; text-align: center">作者</td></tr><tr><td style="text-align: center">V1</td><td style="text-align: center">2016.2.1</td><td style="text-align: center">起草博客、框架</td><td style="text-align: center">Tarantula-7</td></tr><tr><td style="text-align: center">V1.5</td><td style="text-align: center">2016.2.3</td><td style="text-align: center">添加两篇博文摘要</td><td style="text-align: center">Tarantula-7</td></tr><tr><td style="text-align: center">V2</td><td style="text-align: center">2016.2.5</td><td style="text-align: center">完成捣鼓VS2013部分</td><td style="text-align: center">Tarantula-7</td></tr><tr><td style="text-align: center">V3</td><td style="text-align: center">2016.2.29(返校)</td><td style="text-align: center">完成捣鼓一下基于VS2013构建套件的Qt部分</td><td style="text-align: center">Tarantula-7</td></tr><tr><td style="text-align: center">V4</td><td style="text-align: center">2016.3.1(在校)</td><td style="text-align: center">完成全部内容初稿</td><td style="text-align: center">Tarantula-7</td></tr><tr><td style="text-align: center">V4.1</td><td style="text-align: center">2016.3.2</td><td style="text-align: center">完成内容复审</td><td style="text-align: center">Tarantula-7</td></tr></table></center></p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2016/02/02/programPearls_Qt_借Qt中文乱码谈谈Coding中的编码问题/">借Qt中文乱码谈谈Coding中的编码问题</a></p>

        <!-- 
        <p><span>文章作者:</span><a href="/" title="回到主页">Tarantula-7</a></p>
        -->
        <p><span>文章作者:</span>Gary</p>

        <p><span>发布时间:</span>2016-02-02, 19:33:21</p>
        <p><span>最后更新:</span>2016-11-12, 20:31:44</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2016/02/02/programPearls_Qt_借Qt中文乱码谈谈Coding中的编码问题/" title="借Qt中文乱码谈谈Coding中的编码问题">http://durant35.github.io/2016/02/02/programPearls_Qt_借Qt中文乱码谈谈Coding中的编码问题/</a>
            <span class="copy-path" data-clipboard-text="原文: http://durant35.github.io/2016/02/02/programPearls_Qt_借Qt中文乱码谈谈Coding中的编码问题/　　作者: Tarantula-7" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>

        <!-- not to show license information
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
        -->
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2016/02/11/movies_漫威电影/">
                    漫威21部系列电影(持续更新)
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2016/02/02/System_Win8.1简体中文系统切换到繁体中文系统/">
                    Win8.1简体中文系统切换到繁体中文系统
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#先说说环境"><span class="toc-number">1.</span> <span class="toc-text">先说说环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#再看看问题"><span class="toc-number">2.</span> <span class="toc-text">再看看问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解决方案"><span class="toc-number">3.</span> <span class="toc-text">解决方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#捣鼓一下VS-2013"><span class="toc-number">4.</span> <span class="toc-text">捣鼓一下VS 2013</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#捣鼓一下基于VS2013构建套件的Qt"><span class="toc-number">5.</span> <span class="toc-text">捣鼓一下基于VS2013构建套件的Qt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#说在前头的总结"><span class="toc-number">6.</span> <span class="toc-text">说在前头的总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Version-Control"><span class="toc-number">7.</span> <span class="toc-text">Version Control </span></a></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"true"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
        <!--
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
        -->
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
        <!--
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
        -->
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"借Qt中文乱码谈谈Coding中的编码问题　| Tarantula-7's Blog　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
      <div class="duoshuo" id="comments">
    <div id="comment-box" ></div>
    <div class="ds-thread" id="ds-thread" data-thread-key="2016/02/02/programPearls_Qt_借Qt中文乱码谈谈Coding中的编码问题/" data-title="借Qt中文乱码谈谈Coding中的编码问题" data-url="http://durant35.github.io/2016/02/02/programPearls_Qt_借Qt中文乱码谈谈Coding中的编码问题/"></div>
    <script>
        var duoshuoQuery = {short_name:"durant35"};
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            s.async = true; s.charset = 'UTF-8';
            (d.head || d.body).appendChild(s);
        }

        
    </script>
    
    <script> loadComment(); </script>

</div>
    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2016/02/11/movies_漫威电影/" title="上一篇: 漫威21部系列电影(持续更新)">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2016/02/02/System_Win8.1简体中文系统切换到繁体中文系统/" title="下一篇: Win8.1简体中文系统切换到繁体中文系统">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/01/25/raspberry_using-an-external-wireless-card(CF-WU855P)/">RaspberryPi, Use an external wireless card(ComFast-WU855P)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/25/raspberry_enable-ssh-without-UI/">RaspberryPi, enable ssh without UI</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/24/python_sort-Functions/">8 sort functions using python</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/10/linux_libpcap 32-bit&64-bit/">libpcap, 32-bit&64-bit</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/09/OverlappingSounds_Key Word Engineering/">Key Word Engineering</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/07/hexo_Yelee Migrant Note(2)/">hexo博客主题Yelee迁移笔记(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/03/ROS_ROS_Navigation_GettingStarted/">初识ROS自主导航</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/03/linux_sudo_unable_to_resolve_host/">sudo, unable to resolve host</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/02/ROS_ROS_Basics/">ROS Basics</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/01/TACouses_Embedded_System_2016/">Embedded System 2016</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/17/hsw_从VS的dumpbin目录谈x86,i386,x86-64,amd64/">从 VS 的 dumpbin 目录谈 x86、xi386、x86-64、amd64...</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/16/hexo_博客主题Yelee迁移笔记/">hexo博客主题Yelee迁移笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/16/programPearls_dumpbin指南/">dumpbin 指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/08/programPearls_Win&Linux下操作ini配置文件(DIY)/">Win/Linux下操作ini配置文件(DIY)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/08/programPearls_Win&Linux下基本文件操作/">Win/Linux下基本文件操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/08/programPearls_Win&Linux Operate ini configuration files(API)/">Win/Linux下操作ini配置文件(API)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/08/programPearls_precise delay using select/">使用 select 函数实现更为精确的延时</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/08/linux_瞎谈Socket编程_3/">瞎谈Socket编程(三) Win/Linux下的UDP编程</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/26/tool_git几步走/">git几步走</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/16/linux_瞎谈Socket编程_2/">瞎谈 Socket 编程(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/16/hexo_hexo分级目录与多标签/">hexo分级目录与多标签</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/15/linux_瞎谈Socket编程_1/">瞎谈 Socket 编程(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/02/programPearls_C语言中结构体内存free/">C语言中结构体内存free</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/programPearls_Java到底是不是一种纯面向对象语言？/">Java到底是不是一种纯面向对象语言？</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/12/OverlappingSounds_写于幸运保研后/">写于幸运保研后</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/09/OverlappingSounds_Basketball_Never_Stops/">Basketball Never Stops</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/21/tool_CMake_快速入门/">CMake 快速入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/21/programPearls_.h中的ifndef..define..endif/">.h中的#ifndef..#define..#endif</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/25/programPearls_Coding中的编码问题之回顾&深入/">Coding中的编码问题之回顾&深入</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/22/programPearls_Coding中的编码问题之系统学习/">Coding中的编码问题之系统学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/21/programPearls_Coding中的编码问题之入门&概览/">Coding中的编码问题之入门&概览</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/16/mcu_老顽童STM32开发板系列教程笔记/">老顽童STM32开发板系列教程笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/11/movies_漫威电影/">漫威21部系列电影(持续更新)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/02/programPearls_Qt_借Qt中文乱码谈谈Coding中的编码问题/">借Qt中文乱码谈谈Coding中的编码问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/02/System_Win8.1简体中文系统切换到繁体中文系统/">Win8.1简体中文系统切换到繁体中文系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/02/tool_NotePad/">NotePad++</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/02/hexo_在hexo new之后立即打开新建的Markdown文稿/">在hexo new之后立即打开Markdown文稿</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/26/hexo_自定义主题/">hexo自定义主题</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/26/hexo_添加about导航栏/">hexo添加about导航栏</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/24/hexo_hexo错误的分类或标签无法删除/">hexo错误的分类或标签无法删除</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/24/hexo_hexo扫盲/">hexo扫盲</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/24/hexo_2.0x hexo迁移至最新版本笔记/">2.0x hexo迁移至最新版本笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/22/hexo_push你的新博客到Github/">hexo，push你的新博客到Github</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/29/iotCourse_03_ADO连接MySQL数据库/">ADO连接MySQL数据库</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/16/iotCourse_02 Windows下的静态库和动态库/">Windows下的静态库和动态库</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/03/graduatedesign_02 MFRC500-射频芯片射频读写模块完整设计/">MFRC500 射频芯片射频读写模块完整设计</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/28/iotCourse_01 MFC-TabControl控件实现选项卡功能/">MFC TabControl控件实现选项卡功能</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/15/Android_快速搭建Android-ADT开发环境-基于Win7-Win8-1-其他仅供参考/">快速搭建Android ADT开发环境(基于Win7&Win8.1(both 64-bit),其他仅供参考)</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/09/graduatedesign_01 STM32_一-搭建STM32开发环境/">(一) 搭建STM32开发环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/06/16/opengl_数媒HW4参考资料/">数媒HW4参考资料</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/24/opencl_写两个星期OpenCL先-1/">写两个星期OpenCL先(1)</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/24/opencl_win7-64位下VS搭建OpenCL开发环境-Intel显卡/">win7 64位下VS2012搭建OpenCL开发环境(Intel显卡)[win8.1下VS2013亲测同样可行]</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/16/JSP考勤系统-二-JDBC连接MySQL数据库/">JSP考勤系统(二) JDBC连接MySQL数据库</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/15/JSP考勤系统-一-站点框架介绍与入门/">JSP考勤系统(一) 站点框架介绍与入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/11/考勤系统-四-MFC-UI控件之ListCtrl/">考勤系统(四) MFC UI控件之ListCtrl</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/11/考勤系统-三-MFC-UI控件之ComboBox/">考勤系统(三) MFC UI控件之ComboBox</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/06/考勤系统-一-搭建起项目需要的开发环境/">考勤系统(一) 搭建起项目需要的开发环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/04/30/考勤系统-二-MFC-ADO连接MySQL数据库/">考勤系统(二) MFC ADO连接MySQL数据库</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/04/30/hexo_win搭建hexo/">win搭建hexo</a></li></ul>




    <script>
        
    </script>



</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2014-2017 Tarantula-7
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
             post: ".article-entry a[href], .copyright a[href]", 
            
            
            
            
            
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>