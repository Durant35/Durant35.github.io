<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!-- hexo-inject:begin --><!-- hexo-inject:end --><!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="Gary" />



<meta name="description" content="select 初识123456789101112int select(  _In_    int                  nfds,         // 忽略,仅是为了与Berkeley套接字兼容  _Inout_ fd_set               *readfds,     // 指向一个套接字集">
<meta name="keywords" content="Socket">
<meta property="og:type" content="article">
<meta property="og:title" content="使用 select 函数实现更为精确的延时">
<meta property="og:url" content="http://durant35.github.io/2016/09/08/programPearls_precise delay using select/index.html">
<meta property="og:site_name" content="Tarantula-7&#39;s Blog">
<meta property="og:description" content="select 初识123456789101112int select(  _In_    int                  nfds,         // 忽略,仅是为了与Berkeley套接字兼容  _Inout_ fd_set               *readfds,     // 指向一个套接字集合,用来检查其可读性  _Inout_ fd_set">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://durant35.github.io/img/programPearls/socket/select_queue.png">
<meta property="og:image" content="http://durant35.github.io/img/programPearls/socket/establish_3_way_handshake.jpg">
<meta property="og:image" content="http://durant35.github.io/img/programPearls/socket/Velodyne_player.png">
<meta property="og:updated_time" content="2016-10-08T03:55:10.883Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用 select 函数实现更为精确的延时">
<meta name="twitter:description" content="select 初识123456789101112int select(  _In_    int                  nfds,         // 忽略,仅是为了与Berkeley套接字兼容  _Inout_ fd_set               *readfds,     // 指向一个套接字集合,用来检查其可读性  _Inout_ fd_set">
<meta name="twitter:image" content="http://durant35.github.io/img/programPearls/socket/select_queue.png">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Tarantula-7&#39;s Blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/img/favicon.ico">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>使用 select 函数实现更为精确的延时 | Tarantula-7&#39;s Blog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->






</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Gary</a></h1>
        </hgroup>

        
        <p class="header-subtitle">　　你永远流淌在我的记忆里？River flows in you</p>
        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">Home</a></li>
                        
                            <li><a href="/tags">All-tags</a></li>
                        
                            <li><a href="/archives">All-lists</a></li>
                        
                            <li><a href="/Shengjie">Contact</a></li>
                        
                            <li><a href="/about">About</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa 新浪微博" href="http://weibo.com/u/2911566017/home?topnav=1&wvr=6" title="新浪微博"></a>
                            
                                <a class="fa GitHub" href="https://github.com/Durant35" title="GitHub"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/3D/">3D</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AES/">AES</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithm/">Algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-C/">C/C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMD/">CMD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMake/">CMake</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CV/">CV</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DARPA/">DARPA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DES/">DES</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DLL/">DLL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Encoding/">Encoding</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HUAWEI/">HUAWEI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JPEG/">JPEG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSP/">JSP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Key-words/">Key-words</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LZW/">LZW</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MCU/">MCU</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MFC/">MFC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NotePad/">NotePad++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenCL/">OpenCL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenGL/">OpenGL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PCB/">PCB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Qt/">Qt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ROS/">ROS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Socket/">Socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VM/">VM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VS2013/">VS2013</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/">Windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash/">bash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dumpbin/">dumpbin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ini/">ini</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode/">leetcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pcap/">pcap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文件操作/">文件操作</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/漫威电影/">漫威电影</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://wiki.ros.org/">ROS</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://zhiqiu.github.io/">Zhiqiu&#39;s Blog</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://www.ruanyifeng.com/blog/">阮一峰的网络日志</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://rh-song.github.io/">RiHui-Song&#39;s Blog</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://goshin.github.io/">Goshin&#39;s Blog</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://blog.csdn.net/u014593748">Kangdk&#39;s CSDN</a>
                    
                    </div>
                </section>
                

                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Gary</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Gary</a></h1>
            </hgroup>
            
            <p class="header-subtitle">　　你永远流淌在我的记忆里？River flows in you</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">Home</a></li>
                
                    <li><a href="/tags">All-tags</a></li>
                
                    <li><a href="/archives">All-lists</a></li>
                
                    <li><a href="/Shengjie">Contact</a></li>
                
                    <li><a href="/about">About</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa 新浪微博" target="_blank" href="http://weibo.com/u/2911566017/home?topnav=1&wvr=6" title="新浪微博"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/Durant35" title="GitHub"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-programPearls_precise delay using select" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/09/08/programPearls_precise delay using select/" class="article-date">
      <time datetime="2016-09-08T03:51:14.000Z" itemprop="datePublished">2016-09-08</time>
</a>



 
    <a href="/2016/09/08/programPearls_precise delay using select/#comments" title="查看评论">
        <i class="fa fa-comments-o" aria-hidden="true"></i>
        <span class="count-comment"></span>
        
        
            <span class="disqus-comment-count" data-disqus-identifier="2016/09/08/programPearls_precise delay using select/"></span>
        
    </a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      使用 select 函数实现更为精确的延时
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/编程珠玑/">编程珠玑</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Socket/">Socket</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="select-初识"><a href="#select-初识" class="headerlink" title="select 初识"></a>select 初识</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">select</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  _In_    <span class="keyword">int</span>                  nfds,         <span class="comment">// 忽略,仅是为了与Berkeley套接字兼容</span></span></span></span><br><span class="line"><span class="function"><span class="params">  _Inout_ fd_set               *readfds,     <span class="comment">// 指向一个套接字集合,用来检查其可读性</span></span></span></span><br><span class="line"><span class="function"><span class="params">  _Inout_ fd_set               *writefds,    <span class="comment">// 指向一个套接字集合,用来检查其可写性</span></span></span></span><br><span class="line"><span class="function"><span class="params">  _Inout_ fd_set               *exceptfds,   <span class="comment">// 指向一个套接字集合,用来检查错误</span></span></span></span><br><span class="line"><span class="function"><span class="params">  _In_    <span class="keyword">const</span> struct timeval *timeout      <span class="comment">// 指定此函数等待的最长时间,如果为NULL,则最长时间为无限大</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br><span class="line"> </span><br><span class="line">返回值: </span><br><span class="line">  函数调用成功，返回发生网络事件的所有套接字数量的总和</span><br><span class="line">  如果超时返回<span class="number">0</span>，代表在描述词状态改变前已超过timeout时间;</span><br><span class="line">  当有错误发生时则返回SOCKET_ERROR(<span class="number">-1</span>).</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<ul>
<li>select 包含三个 Socket 队列，分别代表： readfds，检查可读性，writefds，检查可写性，exceptfds，例外数据。</li>
<li>timeout 是 select 函数的返回时间。timeout 参数控制 select 完成的时间。若 <font color="blue">timeout 参数为空指针，则 select 将一直阻塞到有一个描述字满足条件</font>，否则的话，timeout 指向一个 timeval 结构，其中指定了 select 调用在返回前等待多长时间。如果 timeval 为 {0,0}，则 select 立即返回，这可用于探询所选套接口的状态，如果处于这种状态，则 select 调用可认为是非阻塞的，且一切适用于非阻塞调用的假设都适用于它。</li>
</ul>
<blockquote>
<p>Windows 下有关 <strong>select</strong> 函数使用的 APIs:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;WinSock2.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> &#123;</span></span><br><span class="line">    <span class="keyword">long</span> tv_sec;  <span class="comment">// 秒</span></span><br><span class="line">    <span class="keyword">long</span> tv_usec; <span class="comment">// 微秒</span></span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">fd_set</span> &#123;</span></span><br><span class="line">    u_int fd_count;                 <span class="comment">// 下面数组的大小</span></span><br><span class="line">    SOCKET fd_array[FD_SETSIZE];    <span class="comment">// 套接字句柄数组</span></span><br><span class="line">&#125; fd_set;</span><br><span class="line"> </span><br><span class="line">FD_ZERO(*fd_set);       <span class="comment">// 初始化 fd_set 为空集合。集合在使用前应该总是清空</span></span><br><span class="line">FD_CLR(fd, *fd_set);    <span class="comment">// 从 fd_set 移除套接字 fd</span></span><br><span class="line">FD_ISSET(fd, *fd_set);  <span class="comment">// 检查 fd 是不是 fd_set 的成员，如果是返回 TRUE</span></span><br><span class="line">FD_SET(fd, *fd_set);    <span class="comment">// 添加套接字 fd 到集合 fd_set</span></span><br><span class="line"><span class="comment">/**************************************************************************/</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>　例如，我们想要检查一个套接字是否有数据需要(可以)接收，我们可以把套接字句柄加入可读性检查队列中，然后调用 select，如果，该套接字没有数据需要(可以)接收， select 函数会把该套接字从可读性检查队列中删除掉，所以我们只要检查该套接字句柄是否还存在于可读性队列中，就可以知道到底有没有数据需要(可以)接收了。<br>    <center><img src="/img/programPearls/socket/select_queue.png" /></center></p>
<h3 id="When-Readable-When-Writable"><a href="#When-Readable-When-Writable" class="headerlink" title="When Readable? When Writable?"></a>When Readable? When Writable?</h3><blockquote>
<p>下面是摘自 <strong>Microsoft</strong> 官网的 API<a href="https://msdn.microsoft.com/zh-cn/library/windows/desktop/ms740141(v=vs.85).aspx">[select function]</a> 说明</p>
<ul>
<li>The parameter readfds identifies the sockets that are to be checked for readability. </li>
</ul>
<p>　If the socket is currently in the listen state, it will be marked as readable if an incoming connection request has been received such that an accept is guaranteed to complete without blocking.<br>　<font color="blue">假如已调用了 listen，而且一个连接正在建立，那么 accept 函数调用会成功，accept 之前，用于监听的 socket 是可读的</font>。<br>　For other sockets, readability means that queued data is available for reading such that a call to recv, WSARecv, WSARecvFrom, or recvfrom is guaranteed not to block.<br>　<font color="blue">对于其他不是用于监听的 Socket，有数据可以读入，则是可读的</font>。</p>
<ul>
<li>The parameter writefds identifies the sockets that are to be checked for writability.<br>　If a socket is processing a connect call (nonblocking), a socket is writeable if the connection establishment successfully completes.<br>　<font color="blue">如果已完成了对一个非阻塞 connect 调用的处理，连接能够成功就是可写</font>。<br>　If the socket is not processing a connect call, writability means a send, sendto, or WSASendto are guaranteed to succeed.<br>　<font color="blue">对于其他不是调用 connect 的 Socket，可以发出数据就是可写的</font>。</li>
</ul>
</blockquote>
<p>　相信你看完官网的说明之后会对 <font color="blue">什么 Socket 可读？什么 Socket 可写</font> 更加捉摸不透(即使有注解)。下面是个人关于这方面的理解，其实所谓可读可写，可以借用 <strong>Linux 一切皆文件</strong> 的思想，任何一个 Socket，其实就是一个文件句柄，当连接建立起来，显然，关于连接两端的 Socket，都是可写的；收发两端均没有数据发送时，关于连接两端的 Socket，都是不可读的；当有一端有数据发送，另一端对应的 Socket 则是可读的。我们借用之前的 <strong>三次握手</strong> 建立连接流程图作进一步解释。<br>    <center><img src="/img/programPearls/socket/establish_3_way_handshake.jpg" /></center><br>　通过设置非阻塞属性，可以实现 <strong>connect</strong>，<strong>accept</strong> 非阻塞调用。上图的阻塞阶段可以理解为无需阻塞了，而变成类似下面的代码流程通过 <strong>select</strong> 函数检测连接状态变化。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>       rwCount;</span><br><span class="line">fd_set    rSSet, wSSet;</span><br><span class="line">SOCKET    listenSoc, connectSoc;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// listenSoc: bind, listen</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// connectSoc: connect</span></span><br><span class="line"> </span><br><span class="line">rwCount = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (rwCount &lt; <span class="number">2</span>)&#123;</span><br><span class="line">  <span class="comment">// listen socket 可读，connect socket 可写 说明建立连接了</span></span><br><span class="line">  rdSSet.fd_count = <span class="number">1</span>;</span><br><span class="line">  rdSSet.fd_array[<span class="number">0</span>] = listenSoc;</span><br><span class="line">  wrSSet.fd_count = <span class="number">1</span>;</span><br><span class="line">  wrSSet.fd_array[<span class="number">0</span>] = connectSoc;</span><br><span class="line">  rwCount = select(<span class="number">0</span>, &amp;rdSSet, &amp;wrSSet, <span class="literal">NULL</span>, &amp;tv);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// listenSoc: accept</span></span><br></pre></td></tr></table></figure></p>
<p>　在非阻塞的状态下，Server 依次通过 <strong>bind</strong>，<strong>listen</strong> 创建队列，监听客户端的连接。Client 通过 <strong>connect</strong> 与 Server 建立连接，并获得该连接对应 Socket 句柄；Server 端的监听队列则保留了与该连接对应的 Socket，通过 <strong>accept</strong> 获取该连接对应的 Socket 句柄。在此之后，Client，Server 两端便可通过与建立的连接对应的 Socket 实现通讯。</p>
<blockquote>
<p><font color="red">总结:</font></p>
<ul>
<li>通过 select 模式，实现了监听 socket 的 accept 和客户端的 read 之间，以及各个客户端之间的 read，可以不用一直阻塞在那，而是在有相应事件的时候再进行阻塞处理，把 accept 和 read 两个长阻塞转化为 select 一个长阻塞。</li>
<li>使用 select 的好处是程序能够在单个线程内同时处理多个套接字连接，这避免了阻塞模式下的线程膨胀问题。</li>
</ul>
</blockquote>
<h3 id="Using-Select-for-Delay"><a href="#Using-Select-for-Delay" class="headerlink" title="Using Select for Delay"></a>Using Select for Delay</h3><p>　从上面的描述中我们可以看到，当 <strong>select</strong> 检测的 socket 状态没有发生改变时，假如设置了 timeout 时间，则会一直阻塞直到 timeout 时间到。利用 <strong>select</strong> 实现 delay 正是利用这样的原理。不难想象，我们需要先创建一些 socket，然后让用于实现 delay 的 select 检测 socket 处于某种状态(不可读或者不可写)，然后通过 select 去检测该不可达状态，最终 select 超时来实现准确的 delay。<br>　下面通过我们项目中一个实际应用 <strong>Velodyne_player</strong> 作进一步说明。<br>    <center><img src="/img/programPearls/socket/Velodyne_player.png" width="520px"/></center></p>
<blockquote>
<ul>
<li><strong>Velodyne_player</strong> 是一个 <strong>.pcap</strong> 文件回播程序，实现的功能是，32线 <strong>Velodyne-HDL-32E</strong> 激光雷达采集的数据是 <strong>UDP</strong> 的数据包，通过 <strong>.pcap</strong> 文件保存；在日后的线下算法调试中通过 <strong>Velodyne_player</strong> 进行回播，解析采集的 <strong>.pcap</strong> 文件，然后通过 <strong>UDP</strong> 的方式发送，模拟 <strong>Velodyne-HDL-32E</strong> 激光雷达数据采集过程。</li>
<li><strong>.pcap</strong> 文件中每一个数据包均带有时间戳，数据按帧(激光雷达一周扫描的数据为一帧)播放，所以可以获取每一帧的起始时间戳，进而获取每一帧的时间间隔。<strong>Velodyne_player</strong> 中我们通过计算当前帧与起始帧的时间间隔，然后利用系统时间，将其转化为系统绝对时间。接下来，问题就便成同步当前机器时间与播放帧系统绝对时间：<br>　　1). 当前帧绝对时间滞后于机器时间，将当前帧数据立即发送<br>　　2). 当前帧绝对时间超前于机器时间，通过 select 延迟超前的时间，再将当前帧数据发送出去</li>
</ul>
</blockquote>
<p>　<font color="#FF8888">1.</font> 首先，需要创建用于 <strong>select</strong> 检测的，我们可以判断所处状态的 socket。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// include needed MFC library hearder files</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;WinSock2.h&gt;   // for mostly socket operation</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;glib.h&gt;		// for g_get_current_time</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>	ARBITRARY_START_PORT	11000</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">static</span> LONG	LastSocket = ARBITRARY_START_PORT;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Debug function: message box for print tempory data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printFunc</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* info, <span class="keyword">int</span> status)</span></span>&#123;</span><br><span class="line">  CString tmp = <span class="string">" = "</span>;</span><br><span class="line">  CString str;</span><br><span class="line">  str.Format(<span class="string">"%d"</span>, status);</span><br><span class="line">  MessageBox(<span class="literal">NULL</span>, info + tmp + str, <span class="string">""</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 静态函数会被自动分配在一个一直使用的存储区，直到退出应用程序实例，避免了调用函数时压栈出栈，速度快很多</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lcm_internal_pipe_create</span><span class="params">(<span class="keyword">int</span> filedes[<span class="number">2</span>])</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span>             status, SocOpt, rwCount, nPort;</span><br><span class="line">  <span class="keyword">short</span>           Port;</span><br><span class="line">  <span class="comment">// readability&amp;writability check socket set</span></span><br><span class="line">  fd_set          rdSSet, wrSSet;</span><br><span class="line">  SOCKET          listenSoc, acceptSoc, connectSoc;</span><br><span class="line">  sockaddr_in     listen_addr, connect_addr;</span><br><span class="line">  timeval         tv;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * listenSoc: 服务器端的socket</span></span><br><span class="line"><span class="comment">	 * connectSoc: 客户端的socket</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">  listenSoc = socket(PF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">  connectSoc = socket(PF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">  listen_addr.sin_family = AF_INET;</span><br><span class="line">  listen_addr.sin_addr.s_addr = inet_addr(<span class="string">"127.0.0.1"</span>);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * This loop ensures that we pick up an UNUSED port. If anything else used this port,</span></span><br><span class="line"><span class="comment">	 *  the entire lcm notification system melts down. The assumption is that we can't bind</span></span><br><span class="line"><span class="comment">	 *  to an address in use once the SO_EXCLUSIVEADDRUSE has been set. If this isn't true, </span></span><br><span class="line"><span class="comment">	 *  another method will need to be implemented.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">  <span class="keyword">do</span>&#123;</span><br><span class="line">    nPort = InterlockedIncrement(&amp;LastSocket);      <span class="comment">// Make sure we're using unique port</span></span><br><span class="line">    <span class="keyword">if</span> (nPort &gt; <span class="number">65500</span>)&#123;                             <span class="comment">// Wrapping, reset the port #</span></span><br><span class="line">      InterlockedCompareExchange(&amp;LastSocket, ARBITRARY_START_PORT, nPort);</span><br><span class="line">    &#125;</span><br><span class="line">    Port = (<span class="keyword">short</span>)nPort;</span><br><span class="line">    listen_addr.sin_port = htons(Port);</span><br><span class="line"></span><br><span class="line">    SocOpt = <span class="number">1</span>;</span><br><span class="line">    status = setsockopt(listenSoc, SOL_SOCKET, SO_EXCLUSIVEADDRUSE, (<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;SocOpt, <span class="keyword">sizeof</span>(SocOpt));</span><br><span class="line">    <span class="keyword">if</span> (status)</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    status = bind(listenSoc, (LPSOCKADDR)&amp;listen_addr, <span class="keyword">sizeof</span>(listen_addr));</span><br><span class="line">  &#125; <span class="keyword">while</span> (status != <span class="number">0</span>);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 1. 非阻塞方式连接</span></span><br><span class="line"><span class="comment">	 *   设置非阻塞方式连接(http://blog.csdn.net/ludw508/article/details/8565203)</span></span><br><span class="line"><span class="comment">	 *     对于阻塞的套接字：0表示正确，SOCKET_ERROR表示错误</span></span><br><span class="line"><span class="comment">	 *     对于非阻塞套接字，不能立刻判断连接是否完成。函数会返回SOCKET_ERROR，但这并不表示出错</span></span><br><span class="line"><span class="comment">	 * 2. 请求队列只能允许一个客户端请求</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">  SocOpt = <span class="number">1</span>;</span><br><span class="line">  status = ioctlsocket(listenSoc, FIONBIO, (u_long *)&amp;SocOpt);</span><br><span class="line">  status = listen(listenSoc, <span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line">  connect_addr.sin_family = AF_INET;</span><br><span class="line">  connect_addr.sin_addr.s_addr = inet_addr(<span class="string">"127.0.0.1"</span>);</span><br><span class="line">  connect_addr.sin_port = htons(Port);</span><br><span class="line">  </span><br><span class="line">  SocOpt = <span class="number">1</span>;</span><br><span class="line">  status = ioctlsocket(connectSoc, FIONBIO, (u_long *)&amp;SocOpt);</span><br><span class="line">  <span class="keyword">if</span> (SOCKET_ERROR == status)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  status = connect(connectSoc, (LPSOCKADDR)&amp;connect_addr, <span class="keyword">sizeof</span>(connect_addr));</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 使用 select 函数来决定连接请求的完成，通过查看套接字是否可写</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">  rwCount = <span class="number">0</span>;</span><br><span class="line">  tv.tv_sec = <span class="number">0</span>;</span><br><span class="line">  tv.tv_usec = <span class="number">20</span> * <span class="number">1000</span>;</span><br><span class="line">  <span class="keyword">while</span> (rwCount &lt; <span class="number">2</span>)&#123;</span><br><span class="line">    rdSSet.fd_count = <span class="number">1</span>;</span><br><span class="line">    rdSSet.fd_array[<span class="number">0</span>] = connectSoc;</span><br><span class="line">    wrSSet.fd_count = <span class="number">1</span>;</span><br><span class="line">    wrSSet.fd_array[<span class="number">0</span>] = listenSoc;</span><br><span class="line">    rwCount = select(<span class="number">0</span>, &amp;wrSSet, &amp;rdSSet, <span class="literal">NULL</span>, &amp;tv);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __TEST__</span></span><br><span class="line">    printFunc(<span class="string">"rwCount ="</span>, rwCount);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Both sockets are ready now to complete the connection.</span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">int</span> addr_len = <span class="keyword">sizeof</span>(listen_addr);</span><br><span class="line">  acceptSoc = accept(listenSoc, (LPSOCKADDR)&amp;listen_addr, &amp;addr_len);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// Restore the sockets to blocking (default behavior).</span></span><br><span class="line">  SocOpt = <span class="number">0</span>;</span><br><span class="line">  status = ioctlsocket(connectSoc, FIONBIO, (u_long *)&amp;SocOpt);</span><br><span class="line">  status = ioctlsocket(acceptSoc, FIONBIO, (u_long *)&amp;SocOpt);</span><br><span class="line"> </span><br><span class="line">  filedes[<span class="number">0</span>] = (<span class="keyword">int</span>)connectSoc;</span><br><span class="line">  filedes[<span class="number">1</span>] = (<span class="keyword">int</span>)acceptSoc;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><font color="red">分析:</font></p>
<ul>
<li>结合前一节关于可读性，可写性的解释，结合上面具体的代码，调用 <strong>lcm_internal_pipe_create</strong> 获得 <strong>connect</strong> 和 <strong>accept</strong> 返回的 socket 句柄，两个 socket 是通过 listen socket 建立的连接的两端，连接成功建立，二者都是可写的；连接中没有任何一方发送数据，故二者都是不可读的。</li>
<li>此外，用于建立连接的  listen socket，因为他的 listen 队列大小为 1，所以，最终该 socket 是不可写的；因为调用 <strong>accept</strong> 后，监听队列被取空，所以该监听 socket 也是不可读的。</li>
<li><strong>lcm_internal_pipe_create</strong> 必须是静态函数，这样该函数的所有变量会被自动分配在一个一直使用的存储区，直到退出应用程序实例，保证 socket 句柄一直存在，一直有效。</li>
</ul>
</blockquote>
<p>　<font color="#FF8888">2.</font> 开启 <strong>gthread</strong> 线程按帧为单位获取激光雷达数据包，并以 <strong>UDP</strong> 的方式发送出去。为了更准确的模拟激光雷达帧数据的播放时间，通过 <strong>select</strong> 实现恰当的延时，保证帧与帧之间播放的时间间隔，每一帧播放的时间与实际情况相符。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Glib time control functions</span></span><br><span class="line"><span class="comment"> * struct timeval: glib Structure used in select() call</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> int64_t <span class="title">timevalToInt64</span><span class="params">(struct timeval tv)</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">int64_t</span>)tv.tv_sec * <span class="number">1000000</span> + tv.tv_usec;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> int64_t <span class="title">timestamp_now</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">  GTimeVal tv;</span><br><span class="line">  g_get_current_time(&amp;tv);</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">int64_t</span>)tv.tv_sec * <span class="number">1000000</span> + tv.tv_usec;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lcm_internal_pipe_close</span><span class="params">(<span class="keyword">int</span> fd)</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> closesocket((SOCKET)fd);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * gthread线程函数</span></span><br><span class="line"><span class="comment"> *  1. 通过NextEvent从.pcap文件获取下一帧激光数据</span></span><br><span class="line"><span class="comment"> *  2. 通过select的准确timeout，同步播放时刻与抓包时间戳</span></span><br><span class="line"><span class="comment"> *  3. 通过PublishEvent通过UDP发送出去，提供给Velodyne_viewer使用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span>* <span class="title">timer_thread_func</span><span class="params">(<span class="keyword">void</span>* user)</span></span>&#123;</span><br><span class="line">  VeloPlayer* velo_player = <span class="keyword">reinterpret_cast</span>&lt;VeloPlayer*&gt; (user);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">int64_t</span> abstime;</span><br><span class="line">  <span class="keyword">int64_t</span> now;</span><br><span class="line">  <span class="keyword">int64_t</span> starttime;</span><br><span class="line">  <span class="keyword">int64_t</span> startabstime;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">sleep_tv</span>;</span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">int64_t</span> sleep_utime;</span><br><span class="line">  fd_set fds;</span><br><span class="line">  <span class="keyword">int</span> timer_pipe[<span class="number">2</span>];</span><br><span class="line">  TRACE(<span class="string">"timer_thread_func \n"</span>);</span><br><span class="line">  <span class="keyword">if</span> (lcm_internal_pipe_create(timer_pipe) != <span class="number">0</span>)&#123;</span><br><span class="line">    TRACE(<span class="string">"lcm_internal_pipe_create failed\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">int</span> status = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">  startabstime = timestamp_now();</span><br><span class="line"> </span><br><span class="line">  velo_player-&gt;NextEvent();</span><br><span class="line">  starttime = timevalToInt64(velo_player-&gt;m_currentTime);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">while</span> (velo_player-&gt;m_exitThread == <span class="number">0</span>)&#123;</span><br><span class="line">    velo_player-&gt;NextEvent();</span><br><span class="line">    abstime = timevalToInt64(velo_player-&gt;m_currentTime) - starttime + startabstime;</span><br><span class="line">    <span class="keyword">if</span> (abstime &lt; <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"> </span><br><span class="line">    now = timestamp_now();</span><br><span class="line">    <span class="keyword">if</span> (abstime &gt;now)&#123;</span><br><span class="line">      sleep_utime = abstime - now;</span><br><span class="line">      sleep_tv.tv_sec = sleep_utime / <span class="number">1000000</span>;</span><br><span class="line">      sleep_tv.tv_usec = sleep_utime % <span class="number">1000000</span>;</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// sleep until the next timed message, or until an abort message</span></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">			 * select: 2rd parameter readfds identifies the sockets that are to be checked for readability</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">      FD_ZERO(&amp;fds);</span><br><span class="line">      FD_SET(timer_pipe[<span class="number">0</span>], &amp;fds);</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">			 * 测试可读性 可写性</span></span><br><span class="line"><span class="comment">			 *  velo_player-&gt;timer_pipe[0/1]: connect socket/accept socket </span></span><br><span class="line"><span class="comment">			 *   已完成一个非阻塞connect的连接(可写)</span></span><br><span class="line"><span class="comment">			 *   没有数据可以接收(不可读 阻塞到超时，超时时间sleep_tv)</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">      <span class="comment">//#define _SELECT_TEST_</span></span><br><span class="line">      <span class="comment">//#define _SELECT_WRITE_TEST_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _SELECT_WRITE_TEST_</span></span><br><span class="line">      status = select(<span class="number">0</span>, <span class="number">0</span>, &amp;fds, <span class="literal">NULL</span>, &amp;sleep_tv);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">      status = select(<span class="number">0</span>, &amp;fds, <span class="number">0</span>, <span class="literal">NULL</span>, &amp;sleep_tv);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _SELECT_TEST_</span></span><br><span class="line">      <span class="keyword">int</span> error = WSAGetLastError();</span><br><span class="line">      printFunc(<span class="string">"status ="</span>, status);</span><br><span class="line">      printFunc(<span class="string">"error ="</span>, error);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">      <span class="comment">// select timed out</span></span><br><span class="line">      <span class="keyword">if</span> (!status)&#123;</span><br><span class="line">        velo_player-&gt;PublishEvent();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span>&#123;</span><br><span class="line">        TRACE(<span class="string">"0 != status %d %d\n"</span>, status, WSAGetLastError());</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (abstime &lt; now)</span><br><span class="line">        TRACE(<span class="string">"abstime &lt; now %ld\n"</span>, now - abstime);</span><br><span class="line">      velo_player-&gt;PublishEvent();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  TRACE(<span class="string">"Thread stoped! \n"</span>);</span><br><span class="line">  <span class="keyword">if</span> (timer_pipe[<span class="number">0</span>] &gt;= <span class="number">0</span>)</span><br><span class="line">    lcm_internal_pipe_close(timer_pipe[<span class="number">0</span>]);</span><br><span class="line">  <span class="keyword">if</span> (timer_pipe[<span class="number">1</span>] &gt;= <span class="number">0</span>)</span><br><span class="line">    lcm_internal_pipe_close(timer_pipe[<span class="number">1</span>]);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>References: </p>
<ul>
<li><a href="http://www.cnblogs.com/ranjiewen/p/5618620.html">Winsock IO模型之select模型</a></li>
<li><a href="http://www.cnblogs.com/XiaoG/archive/2010/08/11/1823581.html">解决Linux Socket select总是返回1的问题</a></li>
</ul>
</blockquote>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2016/09/08/programPearls_precise delay using select/">使用 select 函数实现更为精确的延时</a></p>

        <!-- 
        <p><span>文章作者:</span><a href="/" title="回到主页">Gary</a></p>
        -->
        <p><span>文章作者:</span></p>

        <p><span>发布时间:</span>2016-09-08, 11:51:14</p>
        <p><span>最后更新:</span>2016-10-08, 11:55:10</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2016/09/08/programPearls_precise delay using select/" title="使用 select 函数实现更为精确的延时">http://durant35.github.io/2016/09/08/programPearls_precise delay using select/</a>
            <span class="copy-path" data-clipboard-text="原文: http://durant35.github.io/2016/09/08/programPearls_precise delay using select/　　作者: Gary" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>

        <!-- not to show license information
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
        -->
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2016/09/08/programPearls_Win$Linux Operate ini configuration files(API)/">
                    Win/Linux下操作ini配置文件(API)
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2016/09/08/linux_瞎谈Socket编程_3/">
                    瞎谈Socket编程(三) Win/Linux下的UDP编程
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#select-初识"><span class="toc-number">1.</span> <span class="toc-text">select 初识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#When-Readable-When-Writable"><span class="toc-number">2.</span> <span class="toc-text">When Readable? When Writable?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Using-Select-for-Delay"><span class="toc-number">3.</span> <span class="toc-text">Using Select for Delay</span></a></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-4 i,
        .toc-level-4 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"true"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
        <!--
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
        -->
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
        <!--
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
        -->
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"使用 select 函数实现更为精确的延时　| Tarantula-7's Blog　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
        <section id="comments">
    <style> aside.comment-bar { margin: auto 30px; }</style>
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function(){
            this.page.url = 'http://durant35.github.io/2016/09/08/programPearls_precise delay using select/';
            this.page.identifier = '2016/09/08/programPearls_precise delay using select/';
        };
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = '//durant35.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        }
    </script>
    
    <script> loadComment(); </script>

</section>


    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2016/09/08/programPearls_Win$Linux Operate ini configuration files(API)/" title="上一篇: Win/Linux下操作ini配置文件(API)">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2016/09/08/linux_瞎谈Socket编程_3/" title="下一篇: 瞎谈Socket编程(三) Win/Linux下的UDP编程">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/11/30/TACouses_ES2017_MCU_GPIO/">GPIO 的几种输入输出模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/06/VM_VirtualAddr2PhysicalAddr/">虚拟内存[0?] 虚拟内存地址 $\Longrightarrow$ 物理内存地址</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/06/VM_Changes4LifeCycle/">虚拟内存[02] 不同阶段下的内存变化</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/06/VM_MemoryManage/">虚拟内存[0?] 内存管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/06/VM0_AddressSpace/">虚拟内存[00] 虚拟内存地址空间</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/VM_Stacks/">虚拟内存[02] Linux 中的各种栈：进程栈 线程栈 内核栈 中断栈</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/VM1_UserSpaceSegments/">虚拟内存[01] 用户内存空间的各个段分布</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/24/TACouses_ES2017_PriorityInversionbyResourceSharing/">嵌入式系统导论[04] Solutions for Priority Inversion in Real-time Scheduling</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/24/TACouses_ES2017_MoCs/">嵌入式系统导论[03] Model of Computation</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/28/TACouses_ES2017_Java/">嵌入式系统导论[01] Linux 下手动配置 Java 环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/26/TACouses_ES2017_SystemC/">嵌入式系统导论[02] 浅谈 System C</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/03/programPearls_Summary after Interview in Robosense/">Summary after Robosense's Interview</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/08/linux_ldconfig4RuntimeLibraries/">ldconfig：[load]运行时库管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/21/Algorithms_ICP/">[0024] Iterative Closest Points（迭代最近点）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/21/Algorithms_LeastSquaresLineFitting/">[0025] Least Squares Line Fitting（最小二乘法直线拟合）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/21/programPearls_i=i++/">i = i++;</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/14/tool_CMake_find_package$pkg_check_module/">CMake 查找库: find_package vs pkg_check_modules</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/14/ROS_<arg>$<param>$<rosparam>/">ROS launch file: <arg> vs <param> vs <rosparam></a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/14/hexo_DisqusInsteadofDuoshuo/">hexo：告别多说，拥抱 Disqus</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/14/programPearls_32-bit program on 64-bit OS $ 64-bit program on 32-bit OS/">32-bit program on 64-bit OS & 64-bit program on 32-bit OS</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/13/Algorithms_OnlineJudge4Huawei2017/">算法设计与分析[0023] 秋招华为在线笔试</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/11/programPearls_DES$3DES$AES/">密码学：DES、3DES、AES</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/11/programPearls_JPEG$Arithmetic$LZW/">JPEG编码&算术编码、LZW编码</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/08/Algorithms_BST$R-B Tree/">算法设计与分析[0022] BST（二叉查找树）和 R-B Tree（红黑树）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/07/programPearls_declaration$definition$initialization$assignment/">声明/定义/初始化/赋值</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/06/programPearls_inline$static$const$extern$volatile/">C/C++常见修饰符（inline&static&const&extern&volatile）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/02/Algorithms_BasicMiscs/">算法设计与分析[0021] Some Algorithms Basic Details Review（课程总结）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/26/Algorithms_GraphProblems/">算法设计与分析[0020] 几个有关图的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/26/Algorithms_GreedyAlgorithms/">算法设计与分析[0019] Greedy Algorithms（贪心策略）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/24/Algorithms_Vertex$Edge connectivity degree/">算法设计与分析[0018] 图的点连通度和边连通度</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/08/Algorithms_NP-Complete(I)/">算法设计与分析[0017] NP-完全问题：概述（两道证明习题）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/02/DARPA_Boss_BossandtheUrbanChallenge/">DARPA[Boss]: Boss and the Urban Challenge</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/02/DARPA_Boss_MotionPlanninginUrbanEnvironments/">DARPA[Boss]: Motion Planning in Urban Environments</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/01/Algorithms_BiGraphMatching/">算法设计与分析[0016] 二分图匹配问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/01/Algorithms_UnionFindSet/">算法设计与分析[0015] Union Find Set（并查集）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/26/Algorithms_Dynamic Programming(V)/">算法设计与分析[0014] Dynamic Programming(V) 一道习题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/19/Algorithms_MaximizingFlow/">算法设计与分析[0013] 网络流：最大流（Max Flow）问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/16/hsw_CPUWipeoutIlliteracy/">CPU 扫盲（核心数/线程数）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/13/hsw_UbuntuSystemBootSequence/">一张图带你看 Ubuntu(Linux) 系统启动过程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/12/Algorithms_LongestPalindromicSubsequence/">算法设计与分析[0012] Dynamic Programming(IV)（Longest Palindromic Subsequence）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/03/Algorithms_LongestCommonSubsequence/">算法设计与分析[0011] Dynamic Programming(III)（Longest Common Subsequence）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/28/Algorithms_LongestIncreasingSubsequence/">算法设计与分析[0010] Longest Increasing Subsequence（最长递增子序列）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/23/Algorithms_Dynamic Programming(II)/">算法设计与分析[0009] Dynamic Programming(II)（Maximum Sum/Product Subarray）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/13/Algorithms_Dynamic Programming(I)/">算法设计与分析[0008] Dynamic Programming(I)（Unique Paths）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/06/Algorithms_Minimum Spanning Tree/">算法设计与分析[0007] Minimum Spanning Tree（最小生成树）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/29/Algorithms_Some Shortest-path Algorithms/">算法设计与分析[0006] Some Shortest-path Algorithms（最短路径算法）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/22/Algorithms_BFS/">算法设计与分析[0005] Breadth First Search（广度优先搜索）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/15/Algorithms_DFS/">算法设计与分析[0004] Depth First Search（深度优先搜索）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/10/Algorithms_An Alibaba Interview Question/">算法设计与分析[0003] 一道阿里巴巴面试题（2017） </a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/04/Algorithms_FFT/">算法设计与分析[0002] Divide and Conquer——FFT（快速傅里叶变换）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/26/Algorithms_Divide and Conquer/">算法设计与分析[0001] Divide and Conquer </a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/04/cv_Digital-Image-Process(pg_2016)/">Digital Image Process</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/04/linux_LinuxCommandNotes/">Linux命令小纸条</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/04/tool_vim几步走/">vim几步走</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/04/TACourses_Summer-trainning-in-July,2016/">Summer-trainning in July, 2016</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/02/hexo-md源文件内容修改预览页面刷新无效/">hexo，md源文件内容修改预览页面刷新无效</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/25/raspberry_using_an_external_wireless_card(CF-WU855P)/">RaspberryPi, Use an external wireless card(ComFast-WU855P)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/25/raspberry_enable-ssh-without-UI/">RaspberryPi, enable ssh without UI</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/24/python_sort-Functions/">8 sort functions using python</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/10/linux_libpcap 32-bit$64-bit/">libpcap, 32-bit&64-bit</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/09/OverlappingSounds_Key Word Engineering/">Key Word Engineering</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/07/hexo_Theme Yelee Migrant Note(2)/">hexo博客主题Yelee迁移笔记(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/03/ROS_ROS_Navigation_GettingStarted/">初识ROS自主导航</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/03/linux_sudo_unable_to_resolve_host/">sudo, unable to resolve host</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/02/ROS_ROS_Basics/">ROS Basics</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/01/TACouses_Embedded_System_2016/">嵌入式系统导论[00] Overview, DOL and MPARM</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/17/hsw_从VS的dumpbin目录谈x86,i386,x86-64,amd64/">从 VS 的 dumpbin 目录谈 x86、xi386、x86-64、amd64...</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/16/hexo_Theme Yelee Migrant Note/">hexo博客主题Yelee迁移笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/16/programPearls_dumpbin指南/">dumpbin 指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/08/programPearls_Win$Linux下操作ini配置文件(DIY)/">Win/Linux下操作ini配置文件(DIY)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/08/programPearls_Win$Linux下基本文件操作/">Win/Linux下基本文件操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/08/programPearls_Win$Linux Operate ini configuration files(API)/">Win/Linux下操作ini配置文件(API)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/08/programPearls_precise delay using select/">使用 select 函数实现更为精确的延时</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/08/linux_瞎谈Socket编程_3/">瞎谈Socket编程(三) Win/Linux下的UDP编程</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/26/tool_git几步走/">git几步走</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/16/linux_瞎谈Socket编程_2/">瞎谈 Socket 编程(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/16/hexo_hexo分级目录与多标签/">hexo分级目录与多标签</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/15/linux_瞎谈Socket编程_1/">瞎谈 Socket 编程(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/02/programPearls_C语言中结构体内存free/">C语言中结构体内存free</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/30/programPearls_Java到底是不是一种纯面向对象语言？/">Java到底是不是一种纯面向对象语言？</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/12/OverlappingSounds_写于幸运保研后/">写于幸运保研后</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/09/OverlappingSounds_Basketball_Never_Stops/">Basketball Never Stops</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/21/tool_CMake_快速入门/">CMake 快速入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/21/programPearls_.h中的ifndef..define..endif/">.h中的#ifndef..#define..#endif</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/25/programPearls_Coding中的编码问题之回顾$深入/">Coding中的编码问题之回顾&深入</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/22/programPearls_Coding中的编码问题之系统学习/">Coding中的编码问题之系统学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/21/programPearls_Coding中的编码问题之入门$概览/">Coding中的编码问题之入门&概览</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/16/mcu_老顽童STM32开发板系列教程笔记/">老顽童STM32开发板系列教程笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/11/movies_漫威电影/">漫威21部系列电影(持续更新)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/02/programPearls_Qt_借Qt中文乱码谈谈Coding中的编码问题/">借Qt中文乱码谈谈Coding中的编码问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/02/System_Win8.1简体中文系统切换到繁体中文系统/">Win8.1简体中文系统切换到繁体中文系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/02/tool_NotePad/">NotePad++</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/02/hexo_在hexo new之后立即打开新建的Markdown文稿/">在hexo new之后立即打开Markdown文稿</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/26/hexo_自定义主题/">hexo自定义主题</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/26/hexo_添加about导航栏/">hexo添加about导航栏</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/24/hexo_hexo错误的分类或标签无法删除/">hexo错误的分类或标签无法删除</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/24/hexo_hexo扫盲/">hexo扫盲</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/24/hexo_2.0x hexo迁移至最新版本笔记/">2.0x hexo迁移至最新版本笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/22/hexo_push你的新博客到Github/">hexo，push你的新博客到Github</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/29/iotCourse_03_ADO连接MySQL数据库/">ADO连接MySQL数据库</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/16/iotCourse_02 Windows下的静态库和动态库/">Windows下的静态库和动态库</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/03/graduatedesign_02 MFRC500-射频芯片射频读写模块完整设计/">MFRC500 射频芯片射频读写模块完整设计</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/28/iotCourse_01 MFC-TabControl控件实现选项卡功能/">MFC TabControl控件实现选项卡功能</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/15/Android_快速搭建Android-ADT开发环境-基于Win7-Win8-1-其他仅供参考/">快速搭建Android ADT开发环境(基于Win7&Win8.1(both 64-bit),其他仅供参考)</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/09/graduatedesign_01 STM32_Keil$JLink/">(一) 搭建STM32开发环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/06/16/opengl_数媒HW4参考资料/">数媒HW4参考资料</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/24/opencl_写两个星期OpenCL先-1/">写两个星期OpenCL先(1)</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/24/opencl_win7-64位下VS搭建OpenCL开发环境-Intel显卡/">win7 64位下VS2012搭建OpenCL开发环境(Intel显卡)[win8.1下VS2013亲测同样可行]</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/16/JSP考勤系统-二-JDBC连接MySQL数据库/">JSP考勤系统(二) JDBC连接MySQL数据库</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/15/JSP考勤系统-一-站点框架介绍与入门/">JSP考勤系统(一) 站点框架介绍与入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/11/考勤系统-四-MFC-UI控件之ListCtrl/">考勤系统(四) MFC UI控件之ListCtrl</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/11/考勤系统-三-MFC-UI控件之ComboBox/">考勤系统(三) MFC UI控件之ComboBox</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/06/考勤系统-一-搭建起项目需要的开发环境/">考勤系统(一) 搭建起项目需要的开发环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/04/30/考勤系统-二-MFC-ADO连接MySQL数据库/">考勤系统(二) MFC ADO连接MySQL数据库</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/04/30/hexo_win搭建hexo/">win搭建hexo</a></li></ul>




    <script>
        
    </script>



</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2014-2018 Gary
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by <a href="http://moxfive.xyz/" target="_blank"> MOxFIVE </a><i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
             post: ".article-entry a[href], .copyright a[href]", 
            
            
            
            
            
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>